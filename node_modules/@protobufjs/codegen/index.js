"use strict";
module.exports = codegen;

/**
 * Begins generating a function.
 * @memberof util
 * @param ***REMOVED***string[]***REMOVED*** functionParams Function parameter names
 * @param ***REMOVED***string***REMOVED*** [functionName] Function name if not anonymous
 * @returns ***REMOVED***Codegen***REMOVED*** Appender that appends code to the function's body
 */
function codegen(functionParams, functionName) ***REMOVED***

    /* istanbul ignore if */
    if (typeof functionParams === "string") ***REMOVED***
        functionName = functionParams;
        functionParams = undefined;
    ***REMOVED***

    var body = [];

    /**
     * Appends code to the function's body or finishes generation.
     * @typedef Codegen
     * @type ***REMOVED***function***REMOVED***
     * @param ***REMOVED***string|Object.<string,*>***REMOVED*** [formatStringOrScope] Format string or, to finish the function, an object of additional scope variables, if any
     * @param ***REMOVED***...****REMOVED*** [formatParams] Format parameters
     * @returns ***REMOVED***Codegen|Function***REMOVED*** Itself or the generated function if finished
     * @throws ***REMOVED***Error***REMOVED*** If format parameter counts do not match
     */

    function Codegen(formatStringOrScope) ***REMOVED***
        // note that explicit array handling below makes this ~50% faster

        // finish the function
        if (typeof formatStringOrScope !== "string") ***REMOVED***
            var source = toString();
            if (codegen.verbose)
                console.log("codegen: " + source); // eslint-disable-line no-console
            source = "return " + source;
            if (formatStringOrScope) ***REMOVED***
                var scopeKeys   = Object.keys(formatStringOrScope),
                    scopeParams = new Array(scopeKeys.length + 1),
                    scopeValues = new Array(scopeKeys.length),
                    scopeOffset = 0;
                while (scopeOffset < scopeKeys.length) ***REMOVED***
                    scopeParams[scopeOffset] = scopeKeys[scopeOffset];
                    scopeValues[scopeOffset] = formatStringOrScope[scopeKeys[scopeOffset++]];
                ***REMOVED***
                scopeParams[scopeOffset] = source;
                return Function.apply(null, scopeParams).apply(null, scopeValues); // eslint-disable-line no-new-func
            ***REMOVED***
            return Function(source)(); // eslint-disable-line no-new-func
        ***REMOVED***

        // otherwise append to body
        var formatParams = new Array(arguments.length - 1),
            formatOffset = 0;
        while (formatOffset < formatParams.length)
            formatParams[formatOffset] = arguments[++formatOffset];
        formatOffset = 0;
        formatStringOrScope = formatStringOrScope.replace(/%([%dfijs])/g, function replace($0, $1) ***REMOVED***
            var value = formatParams[formatOffset++];
            switch ($1) ***REMOVED***
                case "d": case "f": return String(Number(value));
                case "i": return String(Math.floor(value));
                case "j": return JSON.stringify(value);
                case "s": return String(value);
            ***REMOVED***
            return "%";
        ***REMOVED***);
        if (formatOffset !== formatParams.length)
            throw Error("parameter count mismatch");
        body.push(formatStringOrScope);
        return Codegen;
    ***REMOVED***

    function toString(functionNameOverride) ***REMOVED***
        return "function " + (functionNameOverride || functionName || "") + "(" + (functionParams && functionParams.join(",") || "") + ")***REMOVED***\n  " + body.join("\n  ") + "\n***REMOVED***";
    ***REMOVED***

    Codegen.toString = toString;
    return Codegen;
***REMOVED***

/**
 * Begins generating a function.
 * @memberof util
 * @function codegen
 * @param ***REMOVED***string***REMOVED*** [functionName] Function name if not anonymous
 * @returns ***REMOVED***Codegen***REMOVED*** Appender that appends code to the function's body
 * @variation 2
 */

/**
 * When set to `true`, codegen will log generated code to console. Useful for debugging.
 * @name util.codegen.verbose
 * @type ***REMOVED***boolean***REMOVED***
 */
codegen.verbose = false;
