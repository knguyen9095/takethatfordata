"use strict";
module.exports = pool;

/**
 * An allocator as used by ***REMOVED***@link util.pool***REMOVED***.
 * @typedef PoolAllocator
 * @type ***REMOVED***function***REMOVED***
 * @param ***REMOVED***number***REMOVED*** size Buffer size
 * @returns ***REMOVED***Uint8Array***REMOVED*** Buffer
 */

/**
 * A slicer as used by ***REMOVED***@link util.pool***REMOVED***.
 * @typedef PoolSlicer
 * @type ***REMOVED***function***REMOVED***
 * @param ***REMOVED***number***REMOVED*** start Start offset
 * @param ***REMOVED***number***REMOVED*** end End offset
 * @returns ***REMOVED***Uint8Array***REMOVED*** Buffer slice
 * @this ***REMOVED***Uint8Array***REMOVED***
 */

/**
 * A general purpose buffer pool.
 * @memberof util
 * @function
 * @param ***REMOVED***PoolAllocator***REMOVED*** alloc Allocator
 * @param ***REMOVED***PoolSlicer***REMOVED*** slice Slicer
 * @param ***REMOVED***number***REMOVED*** [size=8192] Slab size
 * @returns ***REMOVED***PoolAllocator***REMOVED*** Pooled allocator
 */
function pool(alloc, slice, size) ***REMOVED***
    var SIZE   = size || 8192;
    var MAX    = SIZE >>> 1;
    var slab   = null;
    var offset = SIZE;
    return function pool_alloc(size) ***REMOVED***
        if (size < 1 || size > MAX)
            return alloc(size);
        if (offset + size > SIZE) ***REMOVED***
            slab = alloc(SIZE);
            offset = 0;
        ***REMOVED***
        var buf = slice.call(slab, offset, offset += size);
        if (offset & 7) // align to 32 bit
            offset = (offset | 7) + 1;
        return buf;
    ***REMOVED***;
***REMOVED***
