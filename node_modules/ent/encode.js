var punycode = require('punycode');
var revEntities = require('./reversed.json');

module.exports = encode;

function encode (str, opts) ***REMOVED***
    if (typeof str !== 'string') ***REMOVED***
        throw new TypeError('Expected a String');
    ***REMOVED***
    if (!opts) opts = ***REMOVED******REMOVED***;

    var numeric = true;
    if (opts.named) numeric = false;
    if (opts.numeric !== undefined) numeric = opts.numeric;

    var special = opts.special || ***REMOVED***
        '"': true, "'": true,
        '<': true, '>': true,
        '&': true
    ***REMOVED***;

    var codePoints = punycode.ucs2.decode(str);
    var chars = [];
    for (var i = 0; i < codePoints.length; i++) ***REMOVED***
        var cc = codePoints[i];
        var c = punycode.ucs2.encode([ cc ]);
        var e = revEntities[cc];
        if (e && (cc >= 127 || special[c]) && !numeric) ***REMOVED***
            chars.push('&' + (/;$/.test(e) ? e : e + ';'));
        ***REMOVED***
        else if (cc < 32 || cc >= 127 || special[c]) ***REMOVED***
            chars.push('&#' + cc + ';');
        ***REMOVED***
        else ***REMOVED***
            chars.push(c);
        ***REMOVED***
    ***REMOVED***
    return chars.join('');
***REMOVED***
