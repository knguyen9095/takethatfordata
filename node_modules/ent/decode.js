var punycode = require('punycode');
var entities = require('./entities.json');

module.exports = decode;

function decode (str) ***REMOVED***
    if (typeof str !== 'string') ***REMOVED***
        throw new TypeError('Expected a String');
    ***REMOVED***

    return str.replace(/&(#?[^;\W]+;?)/g, function (_, match) ***REMOVED***
        var m;
        if (m = /^#(\d+);?$/.exec(match)) ***REMOVED***
            return punycode.ucs2.encode([ parseInt(m[1], 10) ]);
        ***REMOVED*** else if (m = /^#[Xx]([A-Fa-f0-9]+);?/.exec(match)) ***REMOVED***
            return punycode.ucs2.encode([ parseInt(m[1], 16) ]);
        ***REMOVED*** else ***REMOVED***
            // named entity
            var hasSemi = /;$/.test(match);
            var withoutSemi = hasSemi ? match.replace(/;$/, '') : match;
            var target = entities[withoutSemi] || (hasSemi && entities[match]);

            if (typeof target === 'number') ***REMOVED***
                return punycode.ucs2.encode([ target ]);
            ***REMOVED*** else if (typeof target === 'string') ***REMOVED***
                return target;
            ***REMOVED*** else ***REMOVED***
                return '&' + match;
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***);
***REMOVED***
