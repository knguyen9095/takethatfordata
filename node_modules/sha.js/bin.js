#! /usr/bin/env node

var createHash = require('./browserify')
var argv = process.argv.slice(2)

function pipe (algorithm, s) ***REMOVED***
  var start = Date.now()
  var hash = createHash(algorithm || 'sha1')

  s.on('data', function (data) ***REMOVED***
    hash.update(data)
  ***REMOVED***)

  s.on('end', function () ***REMOVED***
    if (process.env.DEBUG) ***REMOVED***
      return console.log(hash.digest('hex'), Date.now() - start)
    ***REMOVED***

    console.log(hash.digest('hex'))
  ***REMOVED***)
***REMOVED***

function usage () ***REMOVED***
  console.error('sha.js [algorithm=sha1] [filename] # hash filename with algorithm')
  console.error('input | sha.js [algorithm=sha1]    # hash stdin with algorithm')
  console.error('sha.js --help                      # display this message')
***REMOVED***

if (!process.stdin.isTTY) ***REMOVED***
  pipe(argv[0], process.stdin)
***REMOVED*** else if (argv.length) ***REMOVED***
  if (/--help|-h/.test(argv[0])) ***REMOVED***
    usage()
  ***REMOVED*** else ***REMOVED***
    var filename = argv.pop()
    var algorithm = argv.pop()
    pipe(algorithm, require('fs').createReadStream(filename))
  ***REMOVED***
***REMOVED*** else ***REMOVED***
  usage()
***REMOVED***
