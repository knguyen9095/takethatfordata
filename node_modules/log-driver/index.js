var util = require('util');

var LogDriver = function(options)***REMOVED***
  options = options || ***REMOVED******REMOVED***;
  var logger = this;
  if (options.format)***REMOVED***
    this.format = options.format;
  ***REMOVED***
  this.levels = options.levels || ['error', 'warn', 'info', 'debug', 'trace'];
  if (options.level === false)***REMOVED***
    this.level = false;  // don't log anything
  ***REMOVED*** else ***REMOVED***
    this.level = options.level || this.levels[this.levels.length - 1];
    if (this.levels.indexOf(this.level) === -1)***REMOVED***
      throw new Error("Log level '" +
                      this.level +
                      "' does not exist in level list '" + JSON.stringify() + "'");
    ***REMOVED***
  ***REMOVED***
  this.levels.forEach(function(level)***REMOVED***
    if (logLevelShouldOutput(level, logger.level, logger.levels))***REMOVED***
      logger[level] = function()***REMOVED***
        var args = Array.prototype.slice.call(arguments);
        args.unshift(level);  // log level is added as the first parameter
        console.log(logger.format.apply(logger, args));
      ***REMOVED***;
    ***REMOVED*** else ***REMOVED***
      logger[level] = function()***REMOVED***/* no-op, because this log level is ignored */***REMOVED***;
    ***REMOVED***
  ***REMOVED***);
***REMOVED***;

var logLevelShouldOutput = function(logLevel, configuredLevel, levels)***REMOVED***
  if (configuredLevel === false)***REMOVED***
    return false;
  ***REMOVED***
  return (levels.indexOf(logLevel) <= levels.indexOf(configuredLevel));
***REMOVED***;

LogDriver.prototype.format = function()***REMOVED***
  var args = Array.prototype.slice.call(arguments, [1]); // change arguments to an array, but
                                                         // drop the first item (log level)
  var out = "[" + arguments[0] + "] " + JSON.stringify(new Date()) + " ";
  args.forEach(function(arg)***REMOVED***
    out += " " + util.inspect(arg);
  ***REMOVED***);
  return out;
***REMOVED***;

var defaultLogger = null;

var factory = function(options)***REMOVED***
  defaultLogger = new LogDriver(options);
  factory.logger = defaultLogger;
  return defaultLogger;
***REMOVED***;

factory();

module.exports = factory;
