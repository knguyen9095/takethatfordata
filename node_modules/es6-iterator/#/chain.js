"use strict";

var setPrototypeOf = require("es5-ext/object/set-prototype-of")
  , d              = require("d")
  , Iterator       = require("../")
  , validIterable  = require("../valid-iterable")

  , push = Array.prototype.push
  , defineProperties = Object.defineProperties
  , IteratorChain;

IteratorChain = function (iterators) ***REMOVED***
	defineProperties(this, ***REMOVED***
		__iterators__: d("", iterators),
		__current__: d("w", iterators.shift())
	***REMOVED***);
***REMOVED***;
if (setPrototypeOf) setPrototypeOf(IteratorChain, Iterator);

IteratorChain.prototype = Object.create(Iterator.prototype, ***REMOVED***
	constructor: d(IteratorChain),
	next: d(function () ***REMOVED***
		var result;
		if (!this.__current__) return ***REMOVED*** done: true, value: undefined ***REMOVED***;
		result = this.__current__.next();
		while (result.done) ***REMOVED***
			this.__current__ = this.__iterators__.shift();
			if (!this.__current__) return ***REMOVED*** done: true, value: undefined ***REMOVED***;
			result = this.__current__.next();
		***REMOVED***
		return result;
	***REMOVED***)
***REMOVED***);

module.exports = function () ***REMOVED***
	var iterators = [this];
	push.apply(iterators, arguments);
	iterators.forEach(validIterable);
	return new IteratorChain(iterators);
***REMOVED***;
