// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

'use strict';

var stringifyPrimitive = function(v) ***REMOVED***
  switch (typeof v) ***REMOVED***
    case 'string':
      return v;

    case 'boolean':
      return v ? 'true' : 'false';

    case 'number':
      return isFinite(v) ? v : '';

    default:
      return '';
  ***REMOVED***
***REMOVED***;

module.exports = function(obj, sep, eq, name) ***REMOVED***
  sep = sep || '&';
  eq = eq || '=';
  if (obj === null) ***REMOVED***
    obj = undefined;
  ***REMOVED***

  if (typeof obj === 'object') ***REMOVED***
    return map(objectKeys(obj), function(k) ***REMOVED***
      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;
      if (isArray(obj[k])) ***REMOVED***
        return map(obj[k], function(v) ***REMOVED***
          return ks + encodeURIComponent(stringifyPrimitive(v));
        ***REMOVED***).join(sep);
      ***REMOVED*** else ***REMOVED***
        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));
      ***REMOVED***
    ***REMOVED***).join(sep);

  ***REMOVED***

  if (!name) return '';
  return encodeURIComponent(stringifyPrimitive(name)) + eq +
         encodeURIComponent(stringifyPrimitive(obj));
***REMOVED***;

var isArray = Array.isArray || function (xs) ***REMOVED***
  return Object.prototype.toString.call(xs) === '[object Array]';
***REMOVED***;

function map (xs, f) ***REMOVED***
  if (xs.map) return xs.map(f);
  var res = [];
  for (var i = 0; i < xs.length; i++) ***REMOVED***
    res.push(f(xs[i], i));
  ***REMOVED***
  return res;
***REMOVED***

var objectKeys = Object.keys || function (obj) ***REMOVED***
  var res = [];
  for (var key in obj) ***REMOVED***
    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);
  ***REMOVED***
  return res;
***REMOVED***;
