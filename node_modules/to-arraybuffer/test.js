var Buffer = require('buffer').Buffer
var test = require('tape')

var toArrayBuffer = require('.')

function elementsEqual (ab, buffer) ***REMOVED***
	var view = new Uint8Array(ab)
	for (var i = 0; i < view.length; i++) ***REMOVED***
		if (view[i] !== buffer[i]) ***REMOVED***
			return false
		***REMOVED***
	***REMOVED***
	return true
***REMOVED***

test('Basic behavior', function (t) ***REMOVED***
	var buf = new Buffer(10)
	for (var i = 0; i < 10; i++) ***REMOVED***
		buf[i] = i
	***REMOVED***

	var ab = toArrayBuffer(buf)

	t.equals(ab.byteLength, 10, 'correct length')
	t.ok(elementsEqual(ab, buf), 'elements equal')
	t.end()
***REMOVED***)

test('Behavior when input is a subarray 1', function (t) ***REMOVED***
	var origBuf = new Buffer(10)
	for (var i = 0; i < 10; i++) ***REMOVED***
		origBuf[i] = i
	***REMOVED***
	var buf = origBuf.slice(1)

	var ab = toArrayBuffer(buf)

	t.equals(ab.byteLength, 9, 'correct length')
	t.ok(elementsEqual(ab, buf), 'elements equal')
	t.notOk(ab === buf.buffer, 'the underlying ArrayBuffer is not returned when incorrect')
	t.end()
***REMOVED***)

test('Behavior when input is a subarray 2', function (t) ***REMOVED***
	var origBuf = new Buffer(10)
	for (var i = 0; i < 10; i++) ***REMOVED***
		origBuf[i] = i
	***REMOVED***
	var buf = origBuf.slice(0, 9)

	var ab = toArrayBuffer(buf)

	t.equals(ab.byteLength, 9, 'correct length')
	t.ok(elementsEqual(ab, buf), 'elements equal')
	t.notOk(ab === buf.buffer, 'the underlying ArrayBuffer is not returned when incorrect')
	t.end()
***REMOVED***)
