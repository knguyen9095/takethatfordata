'use strict';
var each = require('./_array-methods')(0);
var redefine = require('./_redefine');
var meta = require('./_meta');
var assign = require('./_object-assign');
var weak = require('./_collection-weak');
var isObject = require('./_is-object');
var fails = require('./_fails');
var validate = require('./_validate-collection');
var WEAK_MAP = 'WeakMap';
var getWeak = meta.getWeak;
var isExtensible = Object.isExtensible;
var uncaughtFrozenStore = weak.ufstore;
var tmp = ***REMOVED******REMOVED***;
var InternalMap;

var wrapper = function (get) ***REMOVED***
  return function WeakMap() ***REMOVED***
    return get(this, arguments.length > 0 ? arguments[0] : undefined);
  ***REMOVED***;
***REMOVED***;

var methods = ***REMOVED***
  // 23.3.3.3 WeakMap.prototype.get(key)
  get: function get(key) ***REMOVED***
    if (isObject(key)) ***REMOVED***
      var data = getWeak(key);
      if (data === true) return uncaughtFrozenStore(validate(this, WEAK_MAP)).get(key);
      return data ? data[this._i] : undefined;
    ***REMOVED***
  ***REMOVED***,
  // 23.3.3.5 WeakMap.prototype.set(key, value)
  set: function set(key, value) ***REMOVED***
    return weak.def(validate(this, WEAK_MAP), key, value);
  ***REMOVED***
***REMOVED***;

// 23.3 WeakMap Objects
var $WeakMap = module.exports = require('./_collection')(WEAK_MAP, wrapper, methods, weak, true, true);

// IE11 WeakMap frozen keys fix
if (fails(function () ***REMOVED*** return new $WeakMap().set((Object.freeze || Object)(tmp), 7).get(tmp) != 7; ***REMOVED***)) ***REMOVED***
  InternalMap = weak.getConstructor(wrapper, WEAK_MAP);
  assign(InternalMap.prototype, methods);
  meta.NEED = true;
  each(['delete', 'has', 'get', 'set'], function (key) ***REMOVED***
    var proto = $WeakMap.prototype;
    var method = proto[key];
    redefine(proto, key, function (a, b) ***REMOVED***
      // store frozen objects on internal weakmap shim
      if (isObject(a) && !isExtensible(a)) ***REMOVED***
        if (!this._f) this._f = new InternalMap();
        var result = this._f[key](a, b);
        return key == 'set' ? this : result;
      // store all the rest on native weakmap
      ***REMOVED*** return method.call(this, a, b);
    ***REMOVED***);
  ***REMOVED***);
***REMOVED***
