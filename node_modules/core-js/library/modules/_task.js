var ctx = require('./_ctx');
var invoke = require('./_invoke');
var html = require('./_html');
var cel = require('./_dom-create');
var global = require('./_global');
var process = global.process;
var setTask = global.setImmediate;
var clearTask = global.clearImmediate;
var MessageChannel = global.MessageChannel;
var Dispatch = global.Dispatch;
var counter = 0;
var queue = ***REMOVED******REMOVED***;
var ONREADYSTATECHANGE = 'onreadystatechange';
var defer, channel, port;
var run = function () ***REMOVED***
  var id = +this;
  // eslint-disable-next-line no-prototype-builtins
  if (queue.hasOwnProperty(id)) ***REMOVED***
    var fn = queue[id];
    delete queue[id];
    fn();
  ***REMOVED***
***REMOVED***;
var listener = function (event) ***REMOVED***
  run.call(event.data);
***REMOVED***;
// Node.js 0.9+ & IE10+ has setImmediate, otherwise:
if (!setTask || !clearTask) ***REMOVED***
  setTask = function setImmediate(fn) ***REMOVED***
    var args = [];
    var i = 1;
    while (arguments.length > i) args.push(arguments[i++]);
    queue[++counter] = function () ***REMOVED***
      // eslint-disable-next-line no-new-func
      invoke(typeof fn == 'function' ? fn : Function(fn), args);
    ***REMOVED***;
    defer(counter);
    return counter;
  ***REMOVED***;
  clearTask = function clearImmediate(id) ***REMOVED***
    delete queue[id];
  ***REMOVED***;
  // Node.js 0.8-
  if (require('./_cof')(process) == 'process') ***REMOVED***
    defer = function (id) ***REMOVED***
      process.nextTick(ctx(run, id, 1));
    ***REMOVED***;
  // Sphere (JS game engine) Dispatch API
  ***REMOVED*** else if (Dispatch && Dispatch.now) ***REMOVED***
    defer = function (id) ***REMOVED***
      Dispatch.now(ctx(run, id, 1));
    ***REMOVED***;
  // Browsers with MessageChannel, includes WebWorkers
  ***REMOVED*** else if (MessageChannel) ***REMOVED***
    channel = new MessageChannel();
    port = channel.port2;
    channel.port1.onmessage = listener;
    defer = ctx(port.postMessage, port, 1);
  // Browsers with postMessage, skip WebWorkers
  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'
  ***REMOVED*** else if (global.addEventListener && typeof postMessage == 'function' && !global.importScripts) ***REMOVED***
    defer = function (id) ***REMOVED***
      global.postMessage(id + '', '*');
    ***REMOVED***;
    global.addEventListener('message', listener, false);
  // IE8-
  ***REMOVED*** else if (ONREADYSTATECHANGE in cel('script')) ***REMOVED***
    defer = function (id) ***REMOVED***
      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function () ***REMOVED***
        html.removeChild(this);
        run.call(id);
      ***REMOVED***;
    ***REMOVED***;
  // Rest old browsers
  ***REMOVED*** else ***REMOVED***
    defer = function (id) ***REMOVED***
      setTimeout(ctx(run, id, 1), 0);
    ***REMOVED***;
  ***REMOVED***
***REMOVED***
module.exports = ***REMOVED***
  set: setTask,
  clear: clearTask
***REMOVED***;
