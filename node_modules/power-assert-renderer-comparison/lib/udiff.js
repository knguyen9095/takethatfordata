'use strict';

var DiffMatchPatch = require('diff-match-patch');
var dmp = new DiffMatchPatch();

function udiff (config) ***REMOVED***
    return function diff (text1, text2) ***REMOVED***
        var patch;
        if (config && shouldUseLineLevelDiff(text1, config)) ***REMOVED***
            patch = udiffLines(text1, text2);
        ***REMOVED*** else ***REMOVED***
            patch = udiffChars(text1, text2);
        ***REMOVED***
        return decodeURIComponent(patch);
    ***REMOVED***;
***REMOVED***

function shouldUseLineLevelDiff (text, config) ***REMOVED***
    return config.lineDiffThreshold < text.split(/\r\n|\r|\n/).length;
***REMOVED***

function udiffLines(text1, text2) ***REMOVED***
    /*jshint camelcase: false */
    var a = dmp.diff_linesToChars_(text1, text2);
    var diffs = dmp.diff_main(a.chars1, a.chars2, false);
    dmp.diff_charsToLines_(diffs, a.lineArray);
    dmp.diff_cleanupSemantic(diffs);
    return dmp.patch_toText(dmp.patch_make(text1, diffs));
***REMOVED***

function udiffChars (text1, text2) ***REMOVED***
    /*jshint camelcase: false */
    var diffs = dmp.diff_main(text1, text2, false);
    dmp.diff_cleanupSemantic(diffs);
    return dmp.patch_toText(dmp.patch_make(text1, diffs));
***REMOVED***

module.exports = udiff;
