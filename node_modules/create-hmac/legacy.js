'use strict'
var inherits = require('inherits')
var Buffer = require('safe-buffer').Buffer

var Base = require('cipher-base')

var ZEROS = Buffer.alloc(128)
var blocksize = 64

function Hmac (alg, key) ***REMOVED***
  Base.call(this, 'digest')
  if (typeof key === 'string') ***REMOVED***
    key = Buffer.from(key)
  ***REMOVED***

  this._alg = alg
  this._key = key

  if (key.length > blocksize) ***REMOVED***
    key = alg(key)
  ***REMOVED*** else if (key.length < blocksize) ***REMOVED***
    key = Buffer.concat([key, ZEROS], blocksize)
  ***REMOVED***

  var ipad = this._ipad = Buffer.allocUnsafe(blocksize)
  var opad = this._opad = Buffer.allocUnsafe(blocksize)

  for (var i = 0; i < blocksize; i++) ***REMOVED***
    ipad[i] = key[i] ^ 0x36
    opad[i] = key[i] ^ 0x5C
  ***REMOVED***

  this._hash = [ipad]
***REMOVED***

inherits(Hmac, Base)

Hmac.prototype._update = function (data) ***REMOVED***
  this._hash.push(data)
***REMOVED***

Hmac.prototype._final = function () ***REMOVED***
  var h = this._alg(Buffer.concat(this._hash))
  return this._alg(Buffer.concat([this._opad, h]))
***REMOVED***
module.exports = Hmac
