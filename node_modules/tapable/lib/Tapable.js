/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/

// polyfill from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter
// using the polyfill specifically to avoid the call to `Object.defineProperty` for performance reasons
function fastFilter(fun/*, thisArg*/) ***REMOVED***
	'use strict';

	if (this === void 0 || this === null) ***REMOVED***
		throw new TypeError();
	***REMOVED***

	var t = Object(this);
	var len = t.length >>> 0;
	if (typeof fun !== 'function') ***REMOVED***
		throw new TypeError();
	***REMOVED***

	var res = [];
	var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
	for (var i = 0; i < len; i++) ***REMOVED***
		if (i in t) ***REMOVED***
			var val = t[i];

			// NOTE: Technically this should Object.defineProperty at
			//       the next index, as push can be affected by
			//       properties on Object.prototype and Array.prototype.
			//       But that method's new, and collisions should be
			//       rare, so use the more-compatible alternative.
			if (fun.call(thisArg, val, i, t)) ***REMOVED***
				res.push(val);
			***REMOVED***
		***REMOVED***
	***REMOVED***

	return res;
***REMOVED***

function Tapable() ***REMOVED***
	this._plugins = ***REMOVED******REMOVED***;
***REMOVED***
module.exports = Tapable;

function copyProperties(from, to) ***REMOVED***
	for(var key in from)
		to[key] = from[key];
	return to;
***REMOVED***

Tapable.mixin = function mixinTapable(pt) ***REMOVED***
	copyProperties(Tapable.prototype, pt);
***REMOVED***;

Tapable.prototype.applyPlugins = function applyPlugins(name) ***REMOVED***
	if(!this._plugins[name]) return;
	var args = Array.prototype.slice.call(arguments, 1);
	var plugins = this._plugins[name];
	for(var i = 0; i < plugins.length; i++)
		plugins[i].apply(this, args);
***REMOVED***;

Tapable.prototype.applyPlugins0 = function applyPlugins0(name) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins) return;
	for(var i = 0; i < plugins.length; i++)
		plugins[i].call(this);
***REMOVED***;

Tapable.prototype.applyPlugins1 = function applyPlugins1(name, param) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins) return;
	for(var i = 0; i < plugins.length; i++)
		plugins[i].call(this, param);
***REMOVED***;

Tapable.prototype.applyPlugins2 = function applyPlugins2(name, param1, param2) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins) return;
	for(var i = 0; i < plugins.length; i++)
		plugins[i].call(this, param1, param2);
***REMOVED***;

Tapable.prototype.applyPluginsWaterfall = function applyPluginsWaterfall(name, init) ***REMOVED***
	if(!this._plugins[name]) return init;
	var args = Array.prototype.slice.call(arguments, 1);
	var plugins = this._plugins[name];
	var current = init;
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		args[0] = current;
		current = plugins[i].apply(this, args);
	***REMOVED***
	return current;
***REMOVED***;

Tapable.prototype.applyPluginsWaterfall0 = function applyPluginsWaterfall0(name, init) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins) return init;
	var current = init;
	for(var i = 0; i < plugins.length; i++)
		current = plugins[i].call(this, current);
	return current;
***REMOVED***;

Tapable.prototype.applyPluginsWaterfall1 = function applyPluginsWaterfall1(name, init, param) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins) return init;
	var current = init;
	for(var i = 0; i < plugins.length; i++)
		current = plugins[i].call(this, current, param);
	return current;
***REMOVED***;

Tapable.prototype.applyPluginsWaterfall2 = function applyPluginsWaterfall2(name, init, param1, param2) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins) return init;
	var current = init;
	for(var i = 0; i < plugins.length; i++)
		current = plugins[i].call(this, current, param1, param2);
	return current;
***REMOVED***;

Tapable.prototype.applyPluginsBailResult = function applyPluginsBailResult(name) ***REMOVED***
	if(!this._plugins[name]) return;
	var args = Array.prototype.slice.call(arguments, 1);
	var plugins = this._plugins[name];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		var result = plugins[i].apply(this, args);
		if(typeof result !== "undefined") ***REMOVED***
			return result;
		***REMOVED***
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsBailResult1 = function applyPluginsBailResult1(name, param) ***REMOVED***
	if(!this._plugins[name]) return;
	var plugins = this._plugins[name];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		var result = plugins[i].call(this, param);
		if(typeof result !== "undefined") ***REMOVED***
			return result;
		***REMOVED***
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsBailResult2 = function applyPluginsBailResult2(name, param1, param2) ***REMOVED***
	if(!this._plugins[name]) return;
	var plugins = this._plugins[name];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		var result = plugins[i].call(this, param1, param2);
		if(typeof result !== "undefined") ***REMOVED***
			return result;
		***REMOVED***
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsBailResult3 = function applyPluginsBailResult3(name, param1, param2, param3) ***REMOVED***
	if(!this._plugins[name]) return;
	var plugins = this._plugins[name];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		var result = plugins[i].call(this, param1, param2, param3);
		if(typeof result !== "undefined") ***REMOVED***
			return result;
		***REMOVED***
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsBailResult4 = function applyPluginsBailResult4(name, param1, param2, param3, param4) ***REMOVED***
	if(!this._plugins[name]) return;
	var plugins = this._plugins[name];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		var result = plugins[i].call(this, param1, param2, param3, param4);
		if(typeof result !== "undefined") ***REMOVED***
			return result;
		***REMOVED***
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsBailResult5 = function applyPluginsBailResult5(name, param1, param2, param3, param4, param5) ***REMOVED***
	if(!this._plugins[name]) return;
	var plugins = this._plugins[name];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		var result = plugins[i].call(this, param1, param2, param3, param4, param5);
		if(typeof result !== "undefined") ***REMOVED***
			return result;
		***REMOVED***
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsAsyncSeries = Tapable.prototype.applyPluginsAsync = function applyPluginsAsyncSeries(name) ***REMOVED***
	var args = Array.prototype.slice.call(arguments, 1);
	var callback = args.pop();
	var plugins = this._plugins[name];
	if(!plugins || plugins.length === 0) return callback();
	var i = 0;
	var _this = this;
	args.push(copyProperties(callback, function next(err) ***REMOVED***
		if(err) return callback(err);
		i++;
		if(i >= plugins.length) ***REMOVED***
			return callback();
		***REMOVED***
		plugins[i].apply(_this, args);
	***REMOVED***));
	plugins[0].apply(this, args);
***REMOVED***;

Tapable.prototype.applyPluginsAsyncSeries1 = function applyPluginsAsyncSeries1(name, param, callback) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins || plugins.length === 0) return callback();
	var i = 0;
	var _this = this;
	var innerCallback = copyProperties(callback, function next(err) ***REMOVED***
		if(err) return callback(err);
		i++;
		if(i >= plugins.length) ***REMOVED***
			return callback();
		***REMOVED***
		plugins[i].call(_this, param, innerCallback);
	***REMOVED***);
	plugins[0].call(this, param, innerCallback);
***REMOVED***;

Tapable.prototype.applyPluginsAsyncSeriesBailResult = function applyPluginsAsyncSeriesBailResult(name) ***REMOVED***
	var args = Array.prototype.slice.call(arguments, 1);
	var callback = args.pop();
	if(!this._plugins[name] || this._plugins[name].length === 0) return callback();
	var plugins = this._plugins[name];
	var i = 0;
	var _this = this;
	args.push(copyProperties(callback, function next() ***REMOVED***
		if(arguments.length > 0) return callback.apply(null, arguments);
		i++;
		if(i >= plugins.length) ***REMOVED***
			return callback();
		***REMOVED***
		plugins[i].apply(_this, args);
	***REMOVED***));
	plugins[0].apply(this, args);
***REMOVED***;

Tapable.prototype.applyPluginsAsyncSeriesBailResult1 = function applyPluginsAsyncSeriesBailResult1(name, param, callback) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins || plugins.length === 0) return callback();
	var i = 0;
	var _this = this;
	var innerCallback = copyProperties(callback, function next(err, result) ***REMOVED***
		if(arguments.length > 0) return callback(err, result);
		i++;
		if(i >= plugins.length) ***REMOVED***
			return callback();
		***REMOVED***
		plugins[i].call(_this, param, innerCallback);
	***REMOVED***);
	plugins[0].call(this, param, innerCallback);
***REMOVED***;

Tapable.prototype.applyPluginsAsyncWaterfall = function applyPluginsAsyncWaterfall(name, init, callback) ***REMOVED***
	if(!this._plugins[name] || this._plugins[name].length === 0) return callback(null, init);
	var plugins = this._plugins[name];
	var i = 0;
	var _this = this;
	var next = copyProperties(callback, function(err, value) ***REMOVED***
		if(err) return callback(err);
		i++;
		if(i >= plugins.length) ***REMOVED***
			return callback(null, value);
		***REMOVED***
		plugins[i].call(_this, value, next);
	***REMOVED***);
	plugins[0].call(this, init, next);
***REMOVED***;

Tapable.prototype.applyPluginsParallel = function applyPluginsParallel(name) ***REMOVED***
	var args = Array.prototype.slice.call(arguments, 1);
	var callback = args.pop();
	if(!this._plugins[name] || this._plugins[name].length === 0) return callback();
	var plugins = this._plugins[name];
	var remaining = plugins.length;
	args.push(copyProperties(callback, function(err) ***REMOVED***
		if(remaining < 0) return; // ignore
		if(err) ***REMOVED***
			remaining = -1;
			return callback(err);
		***REMOVED***
		remaining--;
		if(remaining === 0) ***REMOVED***
			return callback();
		***REMOVED***
	***REMOVED***));
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		plugins[i].apply(this, args);
		if(remaining < 0) return;
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsParallelBailResult = function applyPluginsParallelBailResult(name) ***REMOVED***
	var args = Array.prototype.slice.call(arguments, 1);
	var callback = args[args.length - 1];
	if(!this._plugins[name] || this._plugins[name].length === 0) return callback();
	var plugins = this._plugins[name];
	var currentPos = plugins.length;
	var currentResult;
	var done = [];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		args[args.length - 1] = (function(i) ***REMOVED***
			return copyProperties(callback, function() ***REMOVED***
				if(i >= currentPos) return; // ignore
				done.push(i);
				if(arguments.length > 0) ***REMOVED***
					currentPos = i + 1;
					done = fastFilter.call(done, function(item) ***REMOVED***
						return item <= i;
					***REMOVED***);
					currentResult = Array.prototype.slice.call(arguments);
				***REMOVED***
				if(done.length === currentPos) ***REMOVED***
					callback.apply(null, currentResult);
					currentPos = 0;
				***REMOVED***
			***REMOVED***);
		***REMOVED***(i));
		plugins[i].apply(this, args);
	***REMOVED***
***REMOVED***;

Tapable.prototype.applyPluginsParallelBailResult1 = function applyPluginsParallelBailResult1(name, param, callback) ***REMOVED***
	var plugins = this._plugins[name];
	if(!plugins || plugins.length === 0) return callback();
	var currentPos = plugins.length;
	var currentResult;
	var done = [];
	for(var i = 0; i < plugins.length; i++) ***REMOVED***
		var innerCallback = (function(i) ***REMOVED***
			return copyProperties(callback, function() ***REMOVED***
				if(i >= currentPos) return; // ignore
				done.push(i);
				if(arguments.length > 0) ***REMOVED***
					currentPos = i + 1;
					done = fastFilter.call(done, function(item) ***REMOVED***
						return item <= i;
					***REMOVED***);
					currentResult = Array.prototype.slice.call(arguments);
				***REMOVED***
				if(done.length === currentPos) ***REMOVED***
					callback.apply(null, currentResult);
					currentPos = 0;
				***REMOVED***
			***REMOVED***);
		***REMOVED***(i));
		plugins[i].call(this, param, innerCallback);
	***REMOVED***
***REMOVED***;

Tapable.prototype.hasPlugins = function hasPlugins(name) ***REMOVED***
	var plugins = this._plugins[name];
	return plugins && plugins.length > 0;
***REMOVED***;


Tapable.prototype.plugin = function plugin(name, fn) ***REMOVED***
	if(Array.isArray(name)) ***REMOVED***
		name.forEach(function(name) ***REMOVED***
			this.plugin(name, fn);
		***REMOVED***, this);
		return;
	***REMOVED***
	if(!this._plugins[name]) this._plugins[name] = [fn];
	else this._plugins[name].push(fn);
***REMOVED***;

Tapable.prototype.apply = function apply() ***REMOVED***
	for(var i = 0; i < arguments.length; i++) ***REMOVED***
		arguments[i].apply(this);
	***REMOVED***
***REMOVED***;
