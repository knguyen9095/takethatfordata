'use strict';
const path = require('path');
const os = require('os');
const fs = require('fs');
const ini = require('ini');

const readRc = fp => ***REMOVED***
	try ***REMOVED***
		return ini.parse(fs.readFileSync(fp, 'utf8')).prefix;
	***REMOVED*** catch (err) ***REMOVED******REMOVED***
***REMOVED***;

const defaultNpmPrefix = (() => ***REMOVED***
	if (process.env.PREFIX) ***REMOVED***
		return process.env.PREFIX;
	***REMOVED***

	if (process.platform === 'win32') ***REMOVED***
		// `c:\node\node.exe` → `prefix=c:\node\`
		return path.dirname(process.execPath);
	***REMOVED***

	// `/usr/local/bin/node` → `prefix=/usr/local`
	return path.dirname(path.dirname(process.execPath));
***REMOVED***)();

const getNpmPrefix = () => ***REMOVED***
	if (process.env.PREFIX) ***REMOVED***
		return process.env.PREFIX;
	***REMOVED***

	const homePrefix = readRc(path.join(os.homedir(), '.npmrc'));
	if (homePrefix) ***REMOVED***
		return homePrefix;
	***REMOVED***

	const globalConfigPrefix = readRc(path.resolve(defaultNpmPrefix, 'etc', 'npmrc'));
	if (globalConfigPrefix) ***REMOVED***
		return globalConfigPrefix;
	***REMOVED***

	if (process.platform === 'win32' && process.env.APPDATA) ***REMOVED***
		// Hardcoded contents of `c:\Program Files\nodejs\node_modules\npm\.npmrc`
		const prefix = path.join(process.env.APPDATA, 'npm');
		if (fs.existsSync(prefix)) ***REMOVED***
			return prefix;
		***REMOVED***
	***REMOVED***

	return defaultNpmPrefix;
***REMOVED***;

const npmPrefix = path.resolve(getNpmPrefix());

const getYarnPrefix = () => ***REMOVED***
	if (process.env.PREFIX) ***REMOVED***
		return process.env.PREFIX;
	***REMOVED***

	if (process.platform === 'win32' && process.env.LOCALAPPDATA) ***REMOVED***
		const prefix = path.join(process.env.LOCALAPPDATA, 'Yarn');
		if (fs.existsSync(prefix)) ***REMOVED***
			return prefix;
		***REMOVED***
	***REMOVED***

	const configPrefix = path.join(os.homedir(), '.config/yarn');
	if (fs.existsSync(configPrefix)) ***REMOVED***
		return configPrefix;
	***REMOVED***

	const homePrefix = path.join(os.homedir(), '.yarn-config');
	if (fs.existsSync(homePrefix)) ***REMOVED***
		return homePrefix;
	***REMOVED***

	// Yarn supports the npm conventions but the inverse is not true
	return npmPrefix;
***REMOVED***;

exports.npm = ***REMOVED******REMOVED***;
exports.npm.prefix = npmPrefix;
exports.npm.packages = path.join(npmPrefix, process.platform === 'win32' ? 'node_modules' : 'lib/node_modules');
exports.npm.binaries = process.platform === 'win32' ? npmPrefix : path.join(npmPrefix, 'bin');

const yarnPrefix = path.resolve(getYarnPrefix());
exports.yarn = ***REMOVED******REMOVED***;
exports.yarn.prefix = yarnPrefix;
exports.yarn.packages = path.join(yarnPrefix, process.platform === 'win32' ? 'config/global/node_modules' : 'global/node_modules');
exports.yarn.binaries = path.join(exports.yarn.packages, '.bin');
