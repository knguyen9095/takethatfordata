/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
module.exports = function forEachBail(array, iterator, callback) ***REMOVED***
	if(array.length === 0) return callback();
	var currentPos = array.length;
	var currentResult;
	var done = [];
	for(var i = 0; i < array.length; i++) ***REMOVED***
		var itCb = createIteratorCallback(i);
		iterator(array[i], itCb);
		if(currentPos === 0) break;
	***REMOVED***

	function createIteratorCallback(i) ***REMOVED***
		return function() ***REMOVED***
			if(i >= currentPos) return; // ignore
			var args = Array.prototype.slice.call(arguments);
			done.push(i);
			if(args.length > 0) ***REMOVED***
				currentPos = i + 1;
				done = done.filter(function(item) ***REMOVED***
					return item <= i;
				***REMOVED***);
				currentResult = args;
			***REMOVED***
			if(done.length === currentPos) ***REMOVED***
				callback.apply(null, currentResult);
				currentPos = 0;
			***REMOVED***
		***REMOVED***;
	***REMOVED***
***REMOVED***;

module.exports.withIndex = function forEachBailWithIndex(array, iterator, callback) ***REMOVED***
	if(array.length === 0) return callback();
	var currentPos = array.length;
	var currentResult;
	var done = [];
	for(var i = 0; i < array.length; i++) ***REMOVED***
		var itCb = createIteratorCallback(i);
		iterator(array[i], i, itCb);
		if(currentPos === 0) break;
	***REMOVED***

	function createIteratorCallback(i) ***REMOVED***
		return function() ***REMOVED***
			if(i >= currentPos) return; // ignore
			var args = Array.prototype.slice.call(arguments);
			done.push(i);
			if(args.length > 0) ***REMOVED***
				currentPos = i + 1;
				done = done.filter(function(item) ***REMOVED***
					return item <= i;
				***REMOVED***);
				currentResult = args;
			***REMOVED***
			if(done.length === currentPos) ***REMOVED***
				callback.apply(null, currentResult);
				currentPos = 0;
			***REMOVED***
		***REMOVED***;
	***REMOVED***
***REMOVED***;
