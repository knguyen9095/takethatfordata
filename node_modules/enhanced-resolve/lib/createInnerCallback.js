/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
module.exports = function createInnerCallback(callback, options, message, messageOptional) ***REMOVED***
	var log = options.log;
	if(!log) ***REMOVED***
		if(options.stack !== callback.stack) ***REMOVED***
			var callbackWrapper = function callbackWrapper() ***REMOVED***
				return callback.apply(this, arguments);
			***REMOVED***;
			callbackWrapper.stack = options.stack;
			callbackWrapper.missing = options.missing;
			return callbackWrapper;
		***REMOVED***
		return callback;
	***REMOVED***

	function loggingCallbackWrapper() ***REMOVED***
		var i;
		if(message) ***REMOVED***
			if(!messageOptional || theLog.length > 0) ***REMOVED***
				log(message);
				for(i = 0; i < theLog.length; i++)
					log("  " + theLog[i]);
			***REMOVED***
		***REMOVED*** else ***REMOVED***
			for(i = 0; i < theLog.length; i++)
				log(theLog[i]);
		***REMOVED***
		return callback.apply(this, arguments);

	***REMOVED***
	var theLog = [];
	loggingCallbackWrapper.log = function writeLog(msg) ***REMOVED***
		theLog.push(msg);
	***REMOVED***;
	loggingCallbackWrapper.stack = options.stack;
	loggingCallbackWrapper.missing = options.missing;
	return loggingCallbackWrapper;
***REMOVED***;
