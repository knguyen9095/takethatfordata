/**
 * Writes the array as a bitset.
 * @param ***REMOVED***Array<boolean>***REMOVED*** value Array of booleans to write
 * @param ***REMOVED***number=***REMOVED*** offset Offset to read from. Will use and increase ***REMOVED***@link ByteBuffer#offset***REMOVED*** by `length` if omitted.
 * @returns ***REMOVED***!ByteBuffer***REMOVED***
 * @expose
 */
ByteBufferPrototype.writeBitSet = function(value, offset) ***REMOVED***
  //? RELATIVE()  
  if (!this.noAssert) ***REMOVED***
    if (!(value instanceof Array))
      throw TypeError("Illegal BitSet: Not an array");
    //? ASSERT_OFFSET();
  ***REMOVED***

  var start = offset,
      bits = value.length,
      bytes = (bits >> 3),
      bit = 0,
      k;

  offset += this.writeVarint32(bits,offset);

  while(bytes--) ***REMOVED***
    k = (!!value[bit++] & 1) |
        ((!!value[bit++] & 1) << 1) |
        ((!!value[bit++] & 1) << 2) |
        ((!!value[bit++] & 1) << 3) |
        ((!!value[bit++] & 1) << 4) |
        ((!!value[bit++] & 1) << 5) |
        ((!!value[bit++] & 1) << 6) |
        ((!!value[bit++] & 1) << 7);
    this.writeByte(k,offset++);
  ***REMOVED***

  if(bit < bits) ***REMOVED***
    var m = 0; k = 0;
    while(bit < bits) k = k | ((!!value[bit++] & 1) << (m++));
    this.writeByte(k,offset++);
  ***REMOVED***

  if (relative) ***REMOVED***
    this.offset = offset;
    return this;
  ***REMOVED***
  return offset - start;
***REMOVED***

/**
 * Reads a BitSet as an array of booleans.
 * @param ***REMOVED***number=***REMOVED*** offset Offset to read from. Will use and increase ***REMOVED***@link ByteBuffer#offset***REMOVED*** by `length` if omitted.
 * @returns ***REMOVED***Array<boolean>
 * @expose
 */
ByteBufferPrototype.readBitSet = function(offset) ***REMOVED***
  //? RELATIVE()  

  var ret = this.readVarint32(offset),
      bits = ret.value,
      bytes = (bits >> 3),
      bit = 0,
      value = [],
      k;

  offset += ret.length;

  while(bytes--) ***REMOVED***
    k = this.readByte(offset++);
    value[bit++] = !!(k & 0x01);
    value[bit++] = !!(k & 0x02);
    value[bit++] = !!(k & 0x04);
    value[bit++] = !!(k & 0x08);
    value[bit++] = !!(k & 0x10);
    value[bit++] = !!(k & 0x20);
    value[bit++] = !!(k & 0x40);
    value[bit++] = !!(k & 0x80);
  ***REMOVED***

  if(bit < bits) ***REMOVED***
    var m = 0;
    k = this.readByte(offset++);
    while(bit < bits) value[bit++] = !!((k >> (m++)) & 1);
  ***REMOVED***

  if (relative) ***REMOVED***
    this.offset = offset;
  ***REMOVED***
  return value;
***REMOVED***
