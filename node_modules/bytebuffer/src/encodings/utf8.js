//? if (UTF8) ***REMOVED***
// utfx-embeddable

//? include("../../node_modules/utfx/dist/utfx-embeddable.js");

// encodings/utf8

/**
 * Encodes this ByteBuffer's contents between ***REMOVED***@link ByteBuffer#offset***REMOVED*** and ***REMOVED***@link ByteBuffer#limit***REMOVED*** to an UTF8 encoded
 *  string.
 * @returns ***REMOVED***string***REMOVED*** Hex encoded string
 * @throws ***REMOVED***RangeError***REMOVED*** If `offset > limit`
 * @expose
 */
ByteBufferPrototype.toUTF8 = function(begin, end) ***REMOVED***
    if (typeof begin === 'undefined') begin = this.offset;
    if (typeof end === 'undefined') end = this.limit;
    if (!this.noAssert) ***REMOVED***
        //? ASSERT_RANGE();
    ***REMOVED***
    //? if (NODE)
    return this.buffer.toString("utf8", begin, end);
    //? else ***REMOVED***
    var sd; try ***REMOVED***
        utfx.decodeUTF8toUTF16(function() ***REMOVED***
            //? if (DATAVIEW)
            return begin < end ? this.view.getUint8(begin++) : null;
            //? else
            return begin < end ? this.view[begin++] : null;
        ***REMOVED***.bind(this), sd = stringDestination());
    ***REMOVED*** catch (e) ***REMOVED***
        if (begin !== end)
            throw RangeError("Illegal range: Truncated data, "+begin+" != "+end);
    ***REMOVED***
    return sd();
    //? ***REMOVED***
***REMOVED***;

/**
 * Decodes an UTF8 encoded string to a ByteBuffer.
 * @param ***REMOVED***string***REMOVED*** str String to decode
 * @param ***REMOVED***boolean=***REMOVED*** littleEndian Whether to use little or big endian byte order. Defaults to
 *  ***REMOVED***@link ByteBuffer.DEFAULT_ENDIAN***REMOVED***.
 * @param ***REMOVED***boolean=***REMOVED*** noAssert Whether to skip assertions of offsets and values. Defaults to
 *  ***REMOVED***@link ByteBuffer.DEFAULT_NOASSERT***REMOVED***.
 * @returns ***REMOVED***!ByteBuffer***REMOVED*** ByteBuffer
 * @expose
 */
ByteBuffer.fromUTF8 = function(str, littleEndian, noAssert) ***REMOVED***
    if (!noAssert)
        if (typeof str !== 'string')
            throw TypeError("Illegal str: Not a string");
    //? if (NODE) ***REMOVED***
    var bb = new ByteBuffer(0, littleEndian, noAssert);
    bb.buffer = new Buffer(str, "utf8");
    bb.limit = bb.buffer.length;
    //? ***REMOVED*** else ***REMOVED***
    var bb = new ByteBuffer(utfx.calculateUTF16asUTF8(stringSource(str), true)[1], littleEndian, noAssert),
        i = 0;
    utfx.encodeUTF16toUTF8(stringSource(str), function(b) ***REMOVED***
        //? if (DATAVIEW)
        bb.view.setUint8(i++, b);
        //? else
        bb.view[i++] = b;
    ***REMOVED***);
    bb.limit = i;
    //? ***REMOVED***
    return bb;
***REMOVED***;

//? ***REMOVED***