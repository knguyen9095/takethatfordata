var Buffer = require('buffer').Buffer
var test = require('tape')

var http = require('../..')

test('disable fetch', function (t) ***REMOVED***
	var originalFetch
	if (typeof fetch === 'function') ***REMOVED***
		originalFetch = fetch
	***REMOVED***

	var fetchCalled = false
	fetch = function (input, options) ***REMOVED***
		fetchCalled = true
		if (originalFetch) ***REMOVED***
			return originalFetch(input, options)
		***REMOVED***
	***REMOVED***

	http.get(***REMOVED***
		path: '/browserify.png',
		mode: 'disable-fetch'
	***REMOVED***, function (res) ***REMOVED***
		t.ok(!fetchCalled, 'fetch was not called')

		if (originalFetch) ***REMOVED***
			fetch = originalFetch
		***REMOVED***

		res.on('end', function () ***REMOVED***
			t.ok(res.headers['content-type'] === 'image/png', 'content-type was set correctly')
			t.end()
		***REMOVED***)

		res.on('data', function () ***REMOVED******REMOVED***)
	***REMOVED***)
***REMOVED***)
