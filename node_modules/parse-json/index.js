'use strict';
var errorEx = require('error-ex');
var fallback = require('./vendor/parse');

var JSONError = errorEx('JSONError', ***REMOVED***
	fileName: errorEx.append('in %s')
***REMOVED***);

module.exports = function (x, reviver, filename) ***REMOVED***
	if (typeof reviver === 'string') ***REMOVED***
		filename = reviver;
		reviver = null;
	***REMOVED***

	try ***REMOVED***
		try ***REMOVED***
			return JSON.parse(x, reviver);
		***REMOVED*** catch (err) ***REMOVED***
			fallback.parse(x, ***REMOVED***
				mode: 'json',
				reviver: reviver
			***REMOVED***);

			throw err;
		***REMOVED***
	***REMOVED*** catch (err) ***REMOVED***
		var jsonErr = new JSONError(err);

		if (filename) ***REMOVED***
			jsonErr.fileName = filename;
		***REMOVED***

		throw jsonErr;
	***REMOVED***
***REMOVED***;
