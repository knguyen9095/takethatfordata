'use strict';

var fs = require('fs');
var LRU = require('lru-cache');
var shebangCommand = require('shebang-command');

var shebangCache = new LRU(***REMOVED*** max: 50, maxAge: 30 * 1000 ***REMOVED***);  // Cache just for 30sec

function readShebang(command) ***REMOVED***
    var buffer;
    var fd;
    var shebang;

    // Check if it is in the cache first
    if (shebangCache.has(command)) ***REMOVED***
        return shebangCache.get(command);
    ***REMOVED***

    // Read the first 150 bytes from the file
    buffer = new Buffer(150);

    try ***REMOVED***
        fd = fs.openSync(command, 'r');
        fs.readSync(fd, buffer, 0, 150, 0);
        fs.closeSync(fd);
    ***REMOVED*** catch (e) ***REMOVED*** /* empty */ ***REMOVED***

    // Attempt to extract shebang (null is returned if not a shebang)
    shebang = shebangCommand(buffer.toString());

    // Store the shebang in the cache
    shebangCache.set(command, shebang);

    return shebang;
***REMOVED***

module.exports = readShebang;
