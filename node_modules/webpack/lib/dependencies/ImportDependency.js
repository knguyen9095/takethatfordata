/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";
const ModuleDependency = require("./ModuleDependency");
const DepBlockHelpers = require("./DepBlockHelpers");
const webpackMissingPromiseModule = require("./WebpackMissingModule").promise;

class ImportDependency extends ModuleDependency ***REMOVED***
	constructor(request, block) ***REMOVED***
		super(request);
		this.block = block;
	***REMOVED***

	get type() ***REMOVED***
		return "import()";
	***REMOVED***
***REMOVED***

ImportDependency.Template = class ImportDependencyTemplate ***REMOVED***
	apply(dep, source, outputOptions, requestShortener) ***REMOVED***
		const depBlock = dep.block;
		const promise = DepBlockHelpers.getDepBlockPromise(depBlock, outputOptions, requestShortener, "import()");
		const comment = this.getOptionalComment(outputOptions.pathinfo, requestShortener.shorten(dep.request));

		const content = this.getContent(promise, dep, comment);
		source.replace(depBlock.range[0], depBlock.range[1] - 1, content);
	***REMOVED***

	getOptionalComment(pathinfo, shortenedRequest) ***REMOVED***
		if(!pathinfo) ***REMOVED***
			return "";
		***REMOVED***

		return `/*! $***REMOVED***shortenedRequest***REMOVED*** */ `;
	***REMOVED***

	getContent(promise, dep, comment) ***REMOVED***
		if(promise && dep.module) ***REMOVED***
			const stringifiedId = JSON.stringify(dep.module.id);
			return `$***REMOVED***promise***REMOVED***.then(__webpack_require__.bind(null, $***REMOVED***comment***REMOVED***$***REMOVED***stringifiedId***REMOVED***))`;
		***REMOVED***

		if(dep.module) ***REMOVED***
			const stringifiedId = JSON.stringify(dep.module.id);
			return `new Promise(function(resolve) ***REMOVED*** resolve(__webpack_require__($***REMOVED***comment***REMOVED***$***REMOVED***stringifiedId***REMOVED***)); ***REMOVED***)`;
		***REMOVED***

		return webpackMissingPromiseModule(dep.request);
	***REMOVED***
***REMOVED***;

module.exports = ImportDependency;
