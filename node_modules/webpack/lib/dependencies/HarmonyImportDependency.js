/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";
const ModuleDependency = require("./ModuleDependency");

class HarmonyImportDependency extends ModuleDependency ***REMOVED***
	constructor(request, importedVar, range) ***REMOVED***
		super(request);
		this.range = range;
		this.importedVar = importedVar;
	***REMOVED***

	get type() ***REMOVED***
		return "harmony import";
	***REMOVED***

	getReference() ***REMOVED***
		if(!this.module) return null;

		return ***REMOVED***
			module: this.module,
			importedNames: false
		***REMOVED***;
	***REMOVED***

	updateHash(hash) ***REMOVED***
		super.updateHash(hash);
		hash.update((this.module && (!this.module.meta || this.module.meta.harmonyModule)) + "");
	***REMOVED***
***REMOVED***

HarmonyImportDependency.Template = class HarmonyImportDependencyTemplate ***REMOVED***
	apply(dep, source, outputOptions, requestShortener) ***REMOVED***
		const content = makeImportStatement(true, dep, outputOptions, requestShortener);
		source.replace(dep.range[0], dep.range[1] - 1, "");
		source.insert(-1, content);
	***REMOVED***
***REMOVED***;

function getOptionalComment(pathinfo, shortenedRequest) ***REMOVED***
	if(!pathinfo) ***REMOVED***
		return "";
	***REMOVED***
	return `/*! $***REMOVED***shortenedRequest***REMOVED*** */ `;
***REMOVED***

function makeImportStatement(declare, dep, outputOptions, requestShortener) ***REMOVED***
	const comment = getOptionalComment(outputOptions.pathinfo, requestShortener.shorten(dep.request));
	const declaration = declare ? "var " : "";
	const newline = declare ? "\n" : " ";

	if(!dep.module) ***REMOVED***
		const stringifiedError = JSON.stringify(`Cannot find module "$***REMOVED***dep.request***REMOVED***"`);
		return `throw new Error($***REMOVED***stringifiedError***REMOVED***);$***REMOVED***newline***REMOVED***`;
	***REMOVED***

	if(dep.importedVar) ***REMOVED***
		const isHarmonyModule = dep.module.meta && dep.module.meta.harmonyModule;
		const content = `/* harmony import */ $***REMOVED***declaration***REMOVED***$***REMOVED***dep.importedVar***REMOVED*** = __webpack_require__($***REMOVED***comment***REMOVED***$***REMOVED***JSON.stringify(dep.module.id)***REMOVED***);$***REMOVED***newline***REMOVED***`;
		if(isHarmonyModule) ***REMOVED***
			return content;
		***REMOVED***
		return `$***REMOVED***content***REMOVED***/* harmony import */ $***REMOVED***declaration***REMOVED***$***REMOVED***dep.importedVar***REMOVED***_default = __webpack_require__.n($***REMOVED***dep.importedVar***REMOVED***);$***REMOVED***newline***REMOVED***`;
	***REMOVED***

	return "";
***REMOVED***
HarmonyImportDependency.makeImportStatement = makeImportStatement;

module.exports = HarmonyImportDependency;
