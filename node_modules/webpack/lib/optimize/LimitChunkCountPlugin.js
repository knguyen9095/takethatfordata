/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";

class LimitChunkCountPlugin ***REMOVED***
	constructor(options) ***REMOVED***
		if(options !== undefined && typeof options !== "object" || Array.isArray(options)) ***REMOVED***
			throw new Error("Argument should be an options object.\nFor more info on options, see https://webpack.js.org/plugins/");
		***REMOVED***
		this.options = options || ***REMOVED******REMOVED***;
	***REMOVED***
	apply(compiler) ***REMOVED***
		const options = this.options;
		compiler.plugin("compilation", (compilation) => ***REMOVED***
			compilation.plugin("optimize-chunks-advanced", (chunks) => ***REMOVED***
				const maxChunks = options.maxChunks;
				if(!maxChunks) return;
				if(maxChunks < 1) return;
				if(chunks.length <= maxChunks) return;

				if(chunks.length > maxChunks) ***REMOVED***
					const sortedExtendedPairCombinations = chunks.reduce((combinations, a, idx) => ***REMOVED***
						// create combination pairs
						for(let i = 0; i < idx; i++) ***REMOVED***
							const b = chunks[i];
							combinations.push([b, a]);
						***REMOVED***
						return combinations;
					***REMOVED***, []).map((pair) => ***REMOVED***
						// extend combination pairs with size and integrated size
						const a = pair[0].size(options);
						const b = pair[1].size(options);
						const ab = pair[0].integratedSize(pair[1], options);
						return [a + b - ab, ab, pair[0], pair[1], a, b];
					***REMOVED***).filter((extendedPair) => ***REMOVED***
						// filter pairs that do not have an integratedSize
						// meaning they can NOT be integrated!
						return extendedPair[1] !== false;
					***REMOVED***).sort((a, b) => ***REMOVED*** // sadly javascript does an inplace sort here
						// sort them by size
						const diff = b[0] - a[0];
						if(diff !== 0) return diff;
						return a[1] - b[1];
					***REMOVED***);

					const pair = sortedExtendedPairCombinations[0];

					if(pair && pair[2].integrate(pair[3], "limit")) ***REMOVED***
						chunks.splice(chunks.indexOf(pair[3]), 1);
						return true;
					***REMOVED***
				***REMOVED***
			***REMOVED***);
		***REMOVED***);
	***REMOVED***
***REMOVED***
module.exports = LimitChunkCountPlugin;
