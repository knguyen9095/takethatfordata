/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";

class EnsureChunkConditionsPlugin ***REMOVED***

	apply(compiler) ***REMOVED***
		compiler.plugin("compilation", (compilation) => ***REMOVED***
			const triesMap = new Map();
			compilation.plugin(["optimize-chunks-basic", "optimize-extracted-chunks-basic"], (chunks) => ***REMOVED***
				let changed = false;
				chunks.forEach((chunk) => ***REMOVED***
					chunk.forEachModule((module) => ***REMOVED***
						if(!module.chunkCondition) return;
						if(!module.chunkCondition(chunk)) ***REMOVED***
							let usedChunks = triesMap.get(module);
							if(!usedChunks) triesMap.set(module, usedChunks = new Set());
							usedChunks.add(chunk);
							const newChunks = [];
							chunk.parents.forEach((parent) => ***REMOVED***
								if(!usedChunks.has(parent)) ***REMOVED***
									parent.addModule(module);
									module.addChunk(parent);
									newChunks.push(parent);
								***REMOVED***
							***REMOVED***);
							module.rewriteChunkInReasons(chunk, newChunks);
							chunk.removeModule(module);
							changed = true;
						***REMOVED***
					***REMOVED***);
				***REMOVED***);
				if(changed) return true;
			***REMOVED***);
		***REMOVED***);
	***REMOVED***
***REMOVED***
module.exports = EnsureChunkConditionsPlugin;
