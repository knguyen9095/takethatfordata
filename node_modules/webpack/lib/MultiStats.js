/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";

const Stats = require("./Stats");

const optionOrFallback = (optionValue, fallbackValue) => optionValue !== undefined ? optionValue : fallbackValue;

class MultiStats ***REMOVED***
	constructor(stats) ***REMOVED***
		this.stats = stats;
		this.hash = stats.map(stat => stat.hash).join("");
	***REMOVED***

	hasErrors() ***REMOVED***
		return this.stats.map((stat) => stat.hasErrors()).reduce((a, b) => a || b, false);
	***REMOVED***

	hasWarnings() ***REMOVED***
		return this.stats.map((stat) => stat.hasWarnings()).reduce((a, b) => a || b, false);
	***REMOVED***

	toJson(options, forToString) ***REMOVED***
		if(typeof options === "boolean" || typeof options === "string") ***REMOVED***
			options = Stats.presetToOptions(options);
		***REMOVED*** else if(!options) ***REMOVED***
			options = ***REMOVED******REMOVED***;
		***REMOVED***
		const jsons = this.stats.map((stat, idx) => ***REMOVED***
			const childOptions = Stats.getChildOptions(options, idx);
			const obj = stat.toJson(childOptions, forToString);
			obj.name = stat.compilation && stat.compilation.name;
			return obj;
		***REMOVED***);
		const showVersion = typeof options.version === "undefined" ? jsons.every(j => j.version) : options.version !== false;
		const showHash = typeof options.hash === "undefined" ? jsons.every(j => j.hash) : options.hash !== false;
		jsons.forEach(j => ***REMOVED***
			if(showVersion)
				delete j.version;
		***REMOVED***);
		const obj = ***REMOVED***
			errors: jsons.reduce((arr, j) => ***REMOVED***
				return arr.concat(j.errors.map(msg => ***REMOVED***
					return `($***REMOVED***j.name***REMOVED***) $***REMOVED***msg***REMOVED***`;
				***REMOVED***));
			***REMOVED***, []),
			warnings: jsons.reduce((arr, j) => ***REMOVED***
				return arr.concat(j.warnings.map(msg => ***REMOVED***
					return `($***REMOVED***j.name***REMOVED***) $***REMOVED***msg***REMOVED***`;
				***REMOVED***));
			***REMOVED***, [])
		***REMOVED***;
		if(showVersion)
			obj.version = require("../package.json").version;
		if(showHash)
			obj.hash = this.hash;
		if(options.children !== false)
			obj.children = jsons;
		return obj;
	***REMOVED***

	toString(options) ***REMOVED***
		if(typeof options === "boolean" || typeof options === "string") ***REMOVED***
			options = Stats.presetToOptions(options);
		***REMOVED*** else if(!options) ***REMOVED***
			options = ***REMOVED******REMOVED***;
		***REMOVED***

		const useColors = optionOrFallback(options.colors, false);

		const obj = this.toJson(options, true);

		return Stats.jsonToString(obj, useColors);
	***REMOVED***
***REMOVED***

module.exports = MultiStats;
