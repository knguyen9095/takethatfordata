/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";

const RawSource = require("webpack-sources").RawSource;
const ModuleFilenameHelpers = require("./ModuleFilenameHelpers");

class EvalDevToolModuleTemplatePlugin ***REMOVED***
	constructor(sourceUrlComment, moduleFilenameTemplate) ***REMOVED***
		this.sourceUrlComment = sourceUrlComment || "\n//# sourceURL=[url]";
		this.moduleFilenameTemplate = moduleFilenameTemplate || "webpack:///[resourcePath]?[loaders]";
	***REMOVED***

	apply(moduleTemplate) ***REMOVED***
		moduleTemplate.plugin("module", (source, module) => ***REMOVED***
			const content = source.source();
			const str = ModuleFilenameHelpers.createFilename(module, this.moduleFilenameTemplate, moduleTemplate.requestShortener);
			const footer = ["\n",
				ModuleFilenameHelpers.createFooter(module, moduleTemplate.requestShortener),
				this.sourceUrlComment.replace(/\[url\]/g, encodeURI(str).replace(/%2F/g, "/").replace(/%20/g, "_").replace(/%5E/g, "^").replace(/%5C/g, "\\").replace(/^\//, ""))
			].join("\n");
			return new RawSource(`eval($***REMOVED***JSON.stringify(content + footer)***REMOVED***);`);
		***REMOVED***);
		moduleTemplate.plugin("hash", hash => ***REMOVED***
			hash.update("EvalDevToolModuleTemplatePlugin");
			hash.update("2");
		***REMOVED***);
	***REMOVED***
***REMOVED***

module.exports = EvalDevToolModuleTemplatePlugin;
