/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";

const ModuleFilenameHelpers = require("./ModuleFilenameHelpers");

class LoaderOptionsPlugin ***REMOVED***
	constructor(options) ***REMOVED***
		if(typeof options !== "object") options = ***REMOVED******REMOVED***;
		if(!options.test) options.test = ***REMOVED***
			test: () => true
		***REMOVED***;
		this.options = options;
	***REMOVED***

	apply(compiler) ***REMOVED***
		const options = this.options;
		compiler.plugin("compilation", (compilation) => ***REMOVED***
			compilation.plugin("normal-module-loader", (context, module) => ***REMOVED***
				const resource = module.resource;
				if(!resource) return;
				const i = resource.indexOf("?");
				if(ModuleFilenameHelpers.matchObject(options, i < 0 ? resource : resource.substr(0, i))) ***REMOVED***
					const filterSet = new Set(["include", "exclude", "test"]);
					Object.keys(options)
						.filter((key) => !filterSet.has(key))
						.forEach((key) => context[key] = options[key]);
				***REMOVED***
			***REMOVED***);
		***REMOVED***);
	***REMOVED***
***REMOVED***

module.exports = LoaderOptionsPlugin;
