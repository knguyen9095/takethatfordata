/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";

const WebpackError = require("./WebpackError");

module.exports = class CaseSensitiveModulesWarning extends WebpackError ***REMOVED***
	constructor(modules) ***REMOVED***
		super();

		this.name = "CaseSensitiveModulesWarning";
		const sortedModules = this._sort(modules);
		const modulesList = this._moduleMessages(sortedModules);
		this.message = "There are multiple modules with names that only differ in casing.\n" +
			"This can lead to unexpected behavior when compiling on a filesystem with other case-semantic.\n" +
			`Use equal casing. Compare these module identifiers:\n$***REMOVED***modulesList***REMOVED***`;
		this.origin = this.module = sortedModules[0];

		Error.captureStackTrace(this, this.constructor);
	***REMOVED***

	_sort(modules) ***REMOVED***
		return modules.slice().sort((a, b) => ***REMOVED***
			a = a.identifier();
			b = b.identifier();
			/* istanbul ignore next */
			if(a < b) return -1;
			/* istanbul ignore next */
			if(a > b) return 1;
			/* istanbul ignore next */
			return 0;
		***REMOVED***);
	***REMOVED***

	_moduleMessages(modules) ***REMOVED***
		return modules.map((m) => ***REMOVED***
			let message = `* $***REMOVED***m.identifier()***REMOVED***`;
			const validReasons = m.reasons.filter((reason) => reason.module);

			if(validReasons.length > 0) ***REMOVED***
				message += `\n    Used by $***REMOVED***validReasons.length***REMOVED*** module(s), i. e.`;
				message += `\n    $***REMOVED***validReasons[0].module.identifier()***REMOVED***`;
			***REMOVED***
			return message;
		***REMOVED***).join("\n");
	***REMOVED***
***REMOVED***;
