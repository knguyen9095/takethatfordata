/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
/*globals __resourceQuery */
if(module.hot) ***REMOVED***
	var log = require("./log");
	var checkForUpdate = function checkForUpdate(fromUpdate) ***REMOVED***
		module.hot.check().then(function(updatedModules) ***REMOVED***
			if(!updatedModules) ***REMOVED***
				if(fromUpdate)
					log("info", "[HMR] Update applied.");
				else
					log("warning", "[HMR] Cannot find update.");
				return;
			***REMOVED***

			return module.hot.apply(***REMOVED***
				ignoreUnaccepted: true,
				onUnaccepted: function(data) ***REMOVED***
					log("warning", "Ignored an update to unaccepted module " + data.chain.join(" -> "));
				***REMOVED***,
			***REMOVED***).then(function(renewedModules) ***REMOVED***
				require("./log-apply-result")(updatedModules, renewedModules);

				checkForUpdate(true);
			***REMOVED***);
		***REMOVED***).catch(function(err) ***REMOVED***
			var status = module.hot.status();
			if(["abort", "fail"].indexOf(status) >= 0) ***REMOVED***
				log("warning", "[HMR] Cannot apply update.");
				log("warning", "[HMR] " + err.stack || err.message);
				log("warning", "[HMR] You need to restart the application!");
			***REMOVED*** else ***REMOVED***
				log("warning", "[HMR] Update failed: " + err.stack || err.message);
			***REMOVED***
		***REMOVED***);
	***REMOVED***;

	process.on(__resourceQuery.substr(1) || "SIGUSR2", function() ***REMOVED***
		if(module.hot.status() !== "idle") ***REMOVED***
			log("warning", "[HMR] Got signal but currently in " + module.hot.status() + " state.");
			log("warning", "[HMR] Need to be in idle state to start hot update.");
			return;
		***REMOVED***

		checkForUpdate();
	***REMOVED***);
***REMOVED*** else ***REMOVED***
	throw new Error("[HMR] Hot Module Replacement is disabled.");
***REMOVED***
