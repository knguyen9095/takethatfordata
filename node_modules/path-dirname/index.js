'use strict';

var path = require('path');
var inspect = require('util').inspect;

function assertPath(path) ***REMOVED***
  if (typeof path !== 'string') ***REMOVED***
    throw new TypeError('Path must be a string. Received ' + inspect(path));
  ***REMOVED***
***REMOVED***

function posix(path) ***REMOVED***
  assertPath(path);
  if (path.length === 0)
    return '.';
  var code = path.charCodeAt(0);
  var hasRoot = (code === 47/*/*/);
  var end = -1;
  var matchedSlash = true;
  for (var i = path.length - 1; i >= 1; --i) ***REMOVED***
    code = path.charCodeAt(i);
    if (code === 47/*/*/) ***REMOVED***
      if (!matchedSlash) ***REMOVED***
        end = i;
        break;
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      // We saw the first non-path separator
      matchedSlash = false;
    ***REMOVED***
  ***REMOVED***

  if (end === -1)
    return hasRoot ? '/' : '.';
  if (hasRoot && end === 1)
    return '//';
  return path.slice(0, end);
***REMOVED***

function win32(path) ***REMOVED***
  assertPath(path);
  var len = path.length;
  if (len === 0)
    return '.';
  var rootEnd = -1;
  var end = -1;
  var matchedSlash = true;
  var offset = 0;
  var code = path.charCodeAt(0);

  // Try to match a root
  if (len > 1) ***REMOVED***
    if (code === 47/*/*/ || code === 92/*\*/) ***REMOVED***
      // Possible UNC root

      rootEnd = offset = 1;

      code = path.charCodeAt(1);
      if (code === 47/*/*/ || code === 92/*\*/) ***REMOVED***
        // Matched double path separator at beginning
        var j = 2;
        var last = j;
        // Match 1 or more non-path separators
        for (; j < len; ++j) ***REMOVED***
          code = path.charCodeAt(j);
          if (code === 47/*/*/ || code === 92/*\*/)
            break;
        ***REMOVED***
        if (j < len && j !== last) ***REMOVED***
          // Matched!
          last = j;
          // Match 1 or more path separators
          for (; j < len; ++j) ***REMOVED***
            code = path.charCodeAt(j);
            if (code !== 47/*/*/ && code !== 92/*\*/)
              break;
          ***REMOVED***
          if (j < len && j !== last) ***REMOVED***
            // Matched!
            last = j;
            // Match 1 or more non-path separators
            for (; j < len; ++j) ***REMOVED***
              code = path.charCodeAt(j);
              if (code === 47/*/*/ || code === 92/*\*/)
                break;
            ***REMOVED***
            if (j === len) ***REMOVED***
              // We matched a UNC root only
              return path;
            ***REMOVED***
            if (j !== last) ***REMOVED***
              // We matched a UNC root with leftovers

              // Offset by 1 to include the separator after the UNC root to
              // treat it as a "normal root" on top of a (UNC) root
              rootEnd = offset = j + 1;
            ***REMOVED***
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***
    ***REMOVED*** else if ((code >= 65/*A*/ && code <= 90/*Z*/) ||
               (code >= 97/*a*/ && code <= 122/*z*/)) ***REMOVED***
      // Possible device root

      code = path.charCodeAt(1);
      if (path.charCodeAt(1) === 58/*:*/) ***REMOVED***
        rootEnd = offset = 2;
        if (len > 2) ***REMOVED***
          code = path.charCodeAt(2);
          if (code === 47/*/*/ || code === 92/*\*/)
            rootEnd = offset = 3;
        ***REMOVED***
      ***REMOVED***
    ***REMOVED***
  ***REMOVED*** else if (code === 47/*/*/ || code === 92/*\*/) ***REMOVED***
    return path[0];
  ***REMOVED***

  for (var i = len - 1; i >= offset; --i) ***REMOVED***
    code = path.charCodeAt(i);
    if (code === 47/*/*/ || code === 92/*\*/) ***REMOVED***
      if (!matchedSlash) ***REMOVED***
        end = i;
        break;
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      // We saw the first non-path separator
      matchedSlash = false;
    ***REMOVED***
  ***REMOVED***

  if (end === -1) ***REMOVED***
    if (rootEnd === -1)
      return '.';
    else
      end = rootEnd;
  ***REMOVED***
  return path.slice(0, end);
***REMOVED***

module.exports = process.platform === 'win32' ? win32 : posix;
module.exports.posix = posix;
module.exports.win32 = win32;
