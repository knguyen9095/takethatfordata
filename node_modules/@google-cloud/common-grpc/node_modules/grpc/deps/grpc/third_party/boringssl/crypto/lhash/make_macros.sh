#!/bin/sh

include_dir=../../include/openssl
out=$***REMOVED***include_dir***REMOVED***/lhash_macros.h

cat > $out << EOF
/* Copyright (c) 2014, Google Inc.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
 * SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
 * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
 * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE. */

#if !defined(IN_LHASH_H)
#error "Don't include this file directly. Include lhash.h"
#endif

EOF

output_lhash () ***REMOVED***
  type=$1

  cat >> $out << EOF
/* $***REMOVED***type***REMOVED*** */
#define lh_$***REMOVED***type***REMOVED***_new(hash, comp)\\
((LHASH_OF($***REMOVED***type***REMOVED***)*) lh_new(CHECKED_CAST(lhash_hash_func, uint32_t (*) (const $***REMOVED***type***REMOVED*** *), hash), CHECKED_CAST(lhash_cmp_func, int (*) (const $***REMOVED***type***REMOVED*** *a, const $***REMOVED***type***REMOVED*** *b), comp)))

#define lh_$***REMOVED***type***REMOVED***_free(lh)\\
  lh_free(CHECKED_CAST(_LHASH*, LHASH_OF($***REMOVED***type***REMOVED***)*, lh));

#define lh_$***REMOVED***type***REMOVED***_num_items(lh)\\
  lh_num_items(CHECKED_CAST(_LHASH*, LHASH_OF($***REMOVED***type***REMOVED***)*, lh))

#define lh_$***REMOVED***type***REMOVED***_retrieve(lh, data)\\
  (($***REMOVED***type***REMOVED****) lh_retrieve(CHECKED_CAST(_LHASH*, LHASH_OF($***REMOVED***type***REMOVED***)*, lh), CHECKED_CAST(void*, $***REMOVED***type***REMOVED****, data)))

#define lh_$***REMOVED***type***REMOVED***_insert(lh, old_data, data)\\
  lh_insert(CHECKED_CAST(_LHASH*, LHASH_OF($***REMOVED***type***REMOVED***)*, lh), CHECKED_CAST(void**, $***REMOVED***type***REMOVED*****, old_data), CHECKED_CAST(void*, $***REMOVED***type***REMOVED****, data))

#define lh_$***REMOVED***type***REMOVED***_delete(lh, data)\\
  (($***REMOVED***type***REMOVED****) lh_delete(CHECKED_CAST(_LHASH*, LHASH_OF($***REMOVED***type***REMOVED***)*, lh), CHECKED_CAST(void*, $***REMOVED***type***REMOVED****, data)))

#define lh_$***REMOVED***type***REMOVED***_doall(lh, func)\\
  lh_doall(CHECKED_CAST(_LHASH*, LHASH_OF($***REMOVED***type***REMOVED***)*, lh), CHECKED_CAST(void (*)(void*), void (*) ($***REMOVED***type***REMOVED****), func));

#define lh_$***REMOVED***type***REMOVED***_doall_arg(lh, func, arg)\\
  lh_doall_arg(CHECKED_CAST(_LHASH*, LHASH_OF($***REMOVED***type***REMOVED***)*, lh), CHECKED_CAST(void (*)(void*, void*), void (*) ($***REMOVED***type***REMOVED****, void*), func), arg);


EOF
***REMOVED***

lhash_types=$(cat $***REMOVED***include_dir***REMOVED***/lhash.h | grep '^ \* LHASH_OF:' | sed -e 's/.*LHASH_OF://' -e 's/ .*//')

for type in $lhash_types; do
  echo Hash of $***REMOVED***type***REMOVED***
  output_lhash "$***REMOVED***type***REMOVED***"
done

clang-format -i $out
