include_directories(../../include)

if ($***REMOVED***ARCH***REMOVED*** STREQUAL "x86_64")
  set(
    BN_ARCH_SOURCES

    x86_64-mont.$***REMOVED***ASM_EXT***REMOVED***
    x86_64-mont5.$***REMOVED***ASM_EXT***REMOVED***
    rsaz-avx2.$***REMOVED***ASM_EXT***REMOVED***

    rsaz_exp.c
  )
endif()

if ($***REMOVED***ARCH***REMOVED*** STREQUAL "x86")
  set(
    BN_ARCH_SOURCES

    bn-586.$***REMOVED***ASM_EXT***REMOVED***
    co-586.$***REMOVED***ASM_EXT***REMOVED***
    x86-mont.$***REMOVED***ASM_EXT***REMOVED***
  )
endif()

if ($***REMOVED***ARCH***REMOVED*** STREQUAL "arm")
  set(
    BN_ARCH_SOURCES

    armv4-mont.$***REMOVED***ASM_EXT***REMOVED***
  )
endif()

if ($***REMOVED***ARCH***REMOVED*** STREQUAL "aarch64")
  set(
    BN_ARCH_SOURCES

    armv8-mont.$***REMOVED***ASM_EXT***REMOVED***
  )
endif()

add_library(
  bn

  OBJECT

  add.c
  asm/x86_64-gcc.c
  bn.c
  bn_asn1.c
  cmp.c
  convert.c
  ctx.c
  div.c
  exponentiation.c
  generic.c
  gcd.c
  kronecker.c
  montgomery.c
  montgomery_inv.c
  mul.c
  prime.c
  random.c
  shift.c
  sqrt.c

  $***REMOVED***BN_ARCH_SOURCES***REMOVED***
)

perlasm(x86_64-mont.$***REMOVED***ASM_EXT***REMOVED*** asm/x86_64-mont.pl)
perlasm(x86_64-mont5.$***REMOVED***ASM_EXT***REMOVED*** asm/x86_64-mont5.pl)
perlasm(rsaz-avx2.$***REMOVED***ASM_EXT***REMOVED*** asm/rsaz-avx2.pl)
perlasm(bn-586.$***REMOVED***ASM_EXT***REMOVED*** asm/bn-586.pl)
perlasm(co-586.$***REMOVED***ASM_EXT***REMOVED*** asm/co-586.pl)
perlasm(x86-mont.$***REMOVED***ASM_EXT***REMOVED*** asm/x86-mont.pl)
perlasm(armv4-mont.$***REMOVED***ASM_EXT***REMOVED*** asm/armv4-mont.pl)
perlasm(armv8-mont.$***REMOVED***ASM_EXT***REMOVED*** asm/armv8-mont.pl)

add_executable(
  bn_test

  bn_test.cc

  $<TARGET_OBJECTS:test_support>
)

target_link_libraries(bn_test crypto)
add_dependencies(all_tests bn_test)
