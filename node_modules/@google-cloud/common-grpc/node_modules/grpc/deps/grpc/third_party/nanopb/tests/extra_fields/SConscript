# Test that the decoder properly handles unknown fields in the input.

Import("env")

dec = env.GetBuildPath('$BUILD/basic_buffer/$***REMOVED***PROGPREFIX***REMOVED***decode_buffer$***REMOVED***PROGSUFFIX***REMOVED***')
env.RunTest('person_with_extra_field.output', [dec, "person_with_extra_field.pb"])
env.Compare(["person_with_extra_field.output", "person_with_extra_field.expected"])

dec = env.GetBuildPath('$BUILD/basic_stream/$***REMOVED***PROGPREFIX***REMOVED***decode_stream$***REMOVED***PROGSUFFIX***REMOVED***')
env.RunTest('person_with_extra_field_stream.output', [dec, "person_with_extra_field.pb"])
env.Compare(["person_with_extra_field_stream.output", "person_with_extra_field.expected"])

# This uses the backwards compatibility alltypes test, so that
# alltypes_with_extra_fields.pb doesn't have to be remade so often.
dec2 = env.GetBuildPath('$BUILD/backwards_compatibility/$***REMOVED***PROGPREFIX***REMOVED***decode_legacy$***REMOVED***PROGSUFFIX***REMOVED***')
env.RunTest('alltypes_with_extra_fields.output', [dec2, 'alltypes_with_extra_fields.pb'])
