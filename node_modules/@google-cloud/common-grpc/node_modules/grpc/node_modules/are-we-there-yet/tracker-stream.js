'use strict'
var util = require('util')
var stream = require('readable-stream')
var delegate = require('delegates')
var Tracker = require('./tracker.js')

var TrackerStream = module.exports = function (name, size, options) ***REMOVED***
  stream.Transform.call(this, options)
  this.tracker = new Tracker(name, size)
  this.name = name
  this.id = this.tracker.id
  this.tracker.on('change', delegateChange(this))
***REMOVED***
util.inherits(TrackerStream, stream.Transform)

function delegateChange (trackerStream) ***REMOVED***
  return function (name, completion, tracker) ***REMOVED***
    trackerStream.emit('change', name, completion, trackerStream)
  ***REMOVED***
***REMOVED***

TrackerStream.prototype._transform = function (data, encoding, cb) ***REMOVED***
  this.tracker.completeWork(data.length ? data.length : 1)
  this.push(data)
  cb()
***REMOVED***

TrackerStream.prototype._flush = function (cb) ***REMOVED***
  this.tracker.finish()
  cb()
***REMOVED***

delegate(TrackerStream.prototype, 'tracker')
  .method('completed')
  .method('addWork')
