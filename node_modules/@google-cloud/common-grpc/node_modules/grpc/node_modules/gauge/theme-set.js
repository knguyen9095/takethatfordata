'use strict'
var objectAssign = require('object-assign')

module.exports = function () ***REMOVED***
  return ThemeSetProto.newThemeSet()
***REMOVED***

var ThemeSetProto = ***REMOVED******REMOVED***

ThemeSetProto.baseTheme = require('./base-theme.js')

ThemeSetProto.newTheme = function (parent, theme) ***REMOVED***
  if (!theme) ***REMOVED***
    theme = parent
    parent = this.baseTheme
  ***REMOVED***
  return objectAssign(***REMOVED******REMOVED***, parent, theme)
***REMOVED***

ThemeSetProto.getThemeNames = function () ***REMOVED***
  return Object.keys(this.themes)
***REMOVED***

ThemeSetProto.addTheme = function (name, parent, theme) ***REMOVED***
  this.themes[name] = this.newTheme(parent, theme)
***REMOVED***

ThemeSetProto.addToAllThemes = function (theme) ***REMOVED***
  var themes = this.themes
  Object.keys(themes).forEach(function (name) ***REMOVED***
    objectAssign(themes[name], theme)
  ***REMOVED***)
  objectAssign(this.baseTheme, theme)
***REMOVED***

ThemeSetProto.getTheme = function (name) ***REMOVED***
  if (!this.themes[name]) throw this.newMissingThemeError(name)
  return this.themes[name]
***REMOVED***

ThemeSetProto.setDefault = function (opts, name) ***REMOVED***
  if (name == null) ***REMOVED***
    name = opts
    opts = ***REMOVED******REMOVED***
  ***REMOVED***
  var platform = opts.platform == null ? 'fallback' : opts.platform
  var hasUnicode = !!opts.hasUnicode
  var hasColor = !!opts.hasColor
  if (!this.defaults[platform]) this.defaults[platform] = ***REMOVED***true: ***REMOVED******REMOVED***, false: ***REMOVED******REMOVED******REMOVED***
  this.defaults[platform][hasUnicode][hasColor] = name
***REMOVED***

ThemeSetProto.getDefault = function (opts) ***REMOVED***
  if (!opts) opts = ***REMOVED******REMOVED***
  var platformName = opts.platform || process.platform
  var platform = this.defaults[platformName] || this.defaults.fallback
  var hasUnicode = !!opts.hasUnicode
  var hasColor = !!opts.hasColor
  if (!platform) throw this.newMissingDefaultThemeError(platformName, hasUnicode, hasColor)
  if (!platform[hasUnicode][hasColor]) ***REMOVED***
    if (hasUnicode && hasColor && platform[!hasUnicode][hasColor]) ***REMOVED***
      hasUnicode = false
    ***REMOVED*** else if (hasUnicode && hasColor && platform[hasUnicode][!hasColor]) ***REMOVED***
      hasColor = false
    ***REMOVED*** else if (hasUnicode && hasColor && platform[!hasUnicode][!hasColor]) ***REMOVED***
      hasUnicode = false
      hasColor = false
    ***REMOVED*** else if (hasUnicode && !hasColor && platform[!hasUnicode][hasColor]) ***REMOVED***
      hasUnicode = false
    ***REMOVED*** else if (!hasUnicode && hasColor && platform[hasUnicode][!hasColor]) ***REMOVED***
      hasColor = false
    ***REMOVED*** else if (platform === this.defaults.fallback) ***REMOVED***
      throw this.newMissingDefaultThemeError(platformName, hasUnicode, hasColor)
    ***REMOVED***
  ***REMOVED***
  if (platform[hasUnicode][hasColor]) ***REMOVED***
    return this.getTheme(platform[hasUnicode][hasColor])
  ***REMOVED*** else ***REMOVED***
    return this.getDefault(objectAssign(***REMOVED******REMOVED***, opts, ***REMOVED***platform: 'fallback'***REMOVED***))
  ***REMOVED***
***REMOVED***

ThemeSetProto.newMissingThemeError = function newMissingThemeError (name) ***REMOVED***
  var err = new Error('Could not find a gauge theme named "' + name + '"')
  Error.captureStackTrace.call(err, newMissingThemeError)
  err.theme = name
  err.code = 'EMISSINGTHEME'
  return err
***REMOVED***

ThemeSetProto.newMissingDefaultThemeError = function newMissingDefaultThemeError (platformName, hasUnicode, hasColor) ***REMOVED***
  var err = new Error(
    'Could not find a gauge theme for your platform/unicode/color use combo:\n' +
    '    platform = ' + platformName + '\n' +
    '    hasUnicode = ' + hasUnicode + '\n' +
    '    hasColor = ' + hasColor)
  Error.captureStackTrace.call(err, newMissingDefaultThemeError)
  err.platform = platformName
  err.hasUnicode = hasUnicode
  err.hasColor = hasColor
  err.code = 'EMISSINGTHEME'
  return err
***REMOVED***

ThemeSetProto.newThemeSet = function () ***REMOVED***
  var themeset = function (opts) ***REMOVED***
    return themeset.getDefault(opts)
  ***REMOVED***
  return objectAssign(themeset, ThemeSetProto, ***REMOVED***
    themes: objectAssign(***REMOVED******REMOVED***, this.themes),
    baseTheme: objectAssign(***REMOVED******REMOVED***, this.baseTheme),
    defaults: JSON.parse(JSON.stringify(this.defaults || ***REMOVED******REMOVED***))
  ***REMOVED***)
***REMOVED***

