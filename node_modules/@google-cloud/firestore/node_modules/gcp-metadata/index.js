"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
var extend = require("extend");
var request = require("retry-request");
var BASE_URL = 'http://metadata.google.internal/computeMetadata/v1';
function _buildMetadataAccessor(type) ***REMOVED***
    return function metadataAccessor(options, callback) ***REMOVED***
        if (typeof options === 'function') ***REMOVED***
            callback = options;
            options = ***REMOVED******REMOVED***;
        ***REMOVED***
        if (typeof options === 'string') ***REMOVED***
            options = ***REMOVED*** property: options ***REMOVED***;
        ***REMOVED***
        var property = '';
        if (typeof options === 'object' && options.property) ***REMOVED***
            property = '/' + options.property;
        ***REMOVED***
        var reqOpts = extend(true, ***REMOVED***
            uri: BASE_URL + '/' + type + property,
            headers: ***REMOVED*** 'Metadata-Flavor': 'Google' ***REMOVED***
        ***REMOVED***, options);
        delete reqOpts.property;
        var retryRequestOpts = ***REMOVED*** noResponseRetries: 0 ***REMOVED***;
        return request(reqOpts, retryRequestOpts, function (err, res, body) ***REMOVED***
            if (callback) ***REMOVED***
                if (err) ***REMOVED***
                    callback(err);
                ***REMOVED***
                else if (!res) ***REMOVED***
                    callback(new Error('Invalid response from metadata service'));
                ***REMOVED***
                else if (res.statusCode !== 200) ***REMOVED***
                    callback(new Error('Unsuccessful response status code'), res);
                ***REMOVED***
                else ***REMOVED***
                    callback(null, res, body);
                ***REMOVED***
            ***REMOVED***
        ***REMOVED***);
    ***REMOVED***;
***REMOVED***
exports._buildMetadataAccessor = _buildMetadataAccessor;
exports.instance = _buildMetadataAccessor('instance');
exports.project = _buildMetadataAccessor('project');
