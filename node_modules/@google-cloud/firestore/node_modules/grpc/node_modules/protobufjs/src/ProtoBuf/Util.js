/**
 * @alias ProtoBuf.Util
 * @expose
 */
ProtoBuf.Util = (function() ***REMOVED***
    "use strict";

    /**
     * ProtoBuf utilities.
     * @exports ProtoBuf.Util
     * @namespace
     */
    var Util = ***REMOVED******REMOVED***;

    /**
     * Flag if running in node or not.
     * @type ***REMOVED***boolean***REMOVED***
     * @const
     * @expose
     */
    Util.IS_NODE = !!(
        typeof process === 'object' && process+'' === '[object process]' && !process['browser']
    );

    /**
     * Constructs a XMLHttpRequest object.
     * @return ***REMOVED***XMLHttpRequest***REMOVED***
     * @throws ***REMOVED***Error***REMOVED*** If XMLHttpRequest is not supported
     * @expose
     */
    Util.XHR = function() ***REMOVED***
        // No dependencies please, ref: http://www.quirksmode.org/js/xmlhttp.html
        var XMLHttpFactories = [
            function () ***REMOVED***return new XMLHttpRequest()***REMOVED***,
            function () ***REMOVED***return new ActiveXObject("Msxml2.XMLHTTP")***REMOVED***,
            function () ***REMOVED***return new ActiveXObject("Msxml3.XMLHTTP")***REMOVED***,
            function () ***REMOVED***return new ActiveXObject("Microsoft.XMLHTTP")***REMOVED***
        ];
        /** @type ***REMOVED***?XMLHttpRequest***REMOVED*** */
        var xhr = null;
        for (var i=0;i<XMLHttpFactories.length;i++) ***REMOVED***
            try ***REMOVED*** xhr = XMLHttpFactories[i](); ***REMOVED***
            catch (e) ***REMOVED*** continue; ***REMOVED***
            break;
        ***REMOVED***
        if (!xhr)
            throw Error("XMLHttpRequest is not supported");
        return xhr;
    ***REMOVED***;

    /**
     * Fetches a resource.
     * @param ***REMOVED***string***REMOVED*** path Resource path
     * @param ***REMOVED***function(?string)=***REMOVED*** callback Callback receiving the resource's contents. If omitted the resource will
     *   be fetched synchronously. If the request failed, contents will be null.
     * @return ***REMOVED***?string|undefined***REMOVED*** Resource contents if callback is omitted (null if the request failed), else undefined.
     * @expose
     */
    Util.fetch = function(path, callback) ***REMOVED***
        if (callback && typeof callback != 'function')
            callback = null;
        if (Util.IS_NODE) ***REMOVED***
            var fs = require("fs");
            if (callback) ***REMOVED***
                fs.readFile(path, function(err, data) ***REMOVED***
                    if (err)
                        callback(null);
                    else
                        callback(""+data);
                ***REMOVED***);
            ***REMOVED*** else
                try ***REMOVED***
                    return fs.readFileSync(path);
                ***REMOVED*** catch (e) ***REMOVED***
                    return null;
                ***REMOVED***
        ***REMOVED*** else ***REMOVED***
            var xhr = Util.XHR();
            xhr.open('GET', path, callback ? true : false);
            // xhr.setRequestHeader('User-Agent', 'XMLHTTP/1.0');
            xhr.setRequestHeader('Accept', 'text/plain');
            if (typeof xhr.overrideMimeType === 'function') xhr.overrideMimeType('text/plain');
            if (callback) ***REMOVED***
                xhr.onreadystatechange = function() ***REMOVED***
                    if (xhr.readyState != 4) return;
                    if (/* remote */ xhr.status == 200 || /* local */ (xhr.status == 0 && typeof xhr.responseText === 'string'))
                        callback(xhr.responseText);
                    else
                        callback(null);
                ***REMOVED***;
                if (xhr.readyState == 4)
                    return;
                xhr.send(null);
            ***REMOVED*** else ***REMOVED***
                xhr.send(null);
                if (/* remote */ xhr.status == 200 || /* local */ (xhr.status == 0 && typeof xhr.responseText === 'string'))
                    return xhr.responseText;
                return null;
            ***REMOVED***
        ***REMOVED***
    ***REMOVED***;

    /**
     * Converts a string to camel case.
     * @param ***REMOVED***string***REMOVED*** str
     * @returns ***REMOVED***string***REMOVED***
     * @expose
     */
    Util.toCamelCase = function(str) ***REMOVED***
        return str.replace(/_([a-zA-Z])/g, function ($0, $1) ***REMOVED***
            return $1.toUpperCase();
        ***REMOVED***);
    ***REMOVED***;
    
    return Util;
***REMOVED***)();
