//
// Â© Copyright Henrik Ravn 2004
//
// Use, modification and distribution are subject to the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

using System;
using System.Collections;
using System.IO;

// uncomment the define below to include unit tests
//#define nunit
#if nunit
using NUnit.Framework;

// Unit tests for the DotZLib class library
// ----------------------------------------
//
// Use this with NUnit 2 from http://www.nunit.org
//

namespace DotZLibTests
***REMOVED***
    using DotZLib;

    // helper methods
    internal class Utils
    ***REMOVED***
        public static bool byteArrEqual( byte[] lhs, byte[] rhs )
        ***REMOVED***
            if (lhs.Length != rhs.Length)
                return false;
            for (int i = lhs.Length-1; i >= 0; --i)
                if (lhs[i] != rhs[i])
                    return false;
            return true;
        ***REMOVED***

    ***REMOVED***


    [TestFixture]
    public class CircBufferTests
    ***REMOVED***
        #region Circular buffer tests
        [Test]
        public void SinglePutGet()
        ***REMOVED***
            CircularBuffer buf = new CircularBuffer(10);
            Assert.AreEqual( 0, buf.Size );
            Assert.AreEqual( -1, buf.Get() );

            Assert.IsTrue(buf.Put( 1 ));
            Assert.AreEqual( 1, buf.Size );
            Assert.AreEqual( 1, buf.Get() );
            Assert.AreEqual( 0, buf.Size );
            Assert.AreEqual( -1, buf.Get() );
        ***REMOVED***

        [Test]
        public void BlockPutGet()
        ***REMOVED***
            CircularBuffer buf = new CircularBuffer(10);
            byte[] arr = ***REMOVED***1,2,3,4,5,6,7,8,9,10***REMOVED***;
            Assert.AreEqual( 10, buf.Put(arr,0,10) );
            Assert.AreEqual( 10, buf.Size );
            Assert.IsFalse( buf.Put(11) );
            Assert.AreEqual( 1, buf.Get() );
            Assert.IsTrue( buf.Put(11) );

            byte[] arr2 = (byte[])arr.Clone();
            Assert.AreEqual( 9, buf.Get(arr2,1,9) );
            Assert.IsTrue( Utils.byteArrEqual(arr,arr2) );
        ***REMOVED***

        #endregion
    ***REMOVED***

    [TestFixture]
    public class ChecksumTests
    ***REMOVED***
        #region CRC32 Tests
        [Test]
        public void CRC32_Null()
        ***REMOVED***
            CRC32Checksum crc32 = new CRC32Checksum();
            Assert.AreEqual( 0, crc32.Value );

            crc32 = new CRC32Checksum(1);
            Assert.AreEqual( 1, crc32.Value );

            crc32 = new CRC32Checksum(556);
            Assert.AreEqual( 556, crc32.Value );
        ***REMOVED***

        [Test]
        public void CRC32_Data()
        ***REMOVED***
            CRC32Checksum crc32 = new CRC32Checksum();
            byte[] data = ***REMOVED*** 1,2,3,4,5,6,7 ***REMOVED***;
            crc32.Update(data);
            Assert.AreEqual( 0x70e46888, crc32.Value  );

            crc32 = new CRC32Checksum();
            crc32.Update("penguin");
            Assert.AreEqual( 0x0e5c1a120, crc32.Value );

            crc32 = new CRC32Checksum(1);
            crc32.Update("penguin");
            Assert.AreEqual(0x43b6aa94, crc32.Value);

        ***REMOVED***
        #endregion

        #region Adler tests

        [Test]
        public void Adler_Null()
        ***REMOVED***
            AdlerChecksum adler = new AdlerChecksum();
            Assert.AreEqual(0, adler.Value);

            adler = new AdlerChecksum(1);
            Assert.AreEqual( 1, adler.Value );

            adler = new AdlerChecksum(556);
            Assert.AreEqual( 556, adler.Value );
        ***REMOVED***

        [Test]
        public void Adler_Data()
        ***REMOVED***
            AdlerChecksum adler = new AdlerChecksum(1);
            byte[] data = ***REMOVED*** 1,2,3,4,5,6,7 ***REMOVED***;
            adler.Update(data);
            Assert.AreEqual( 0x5b001d, adler.Value  );

            adler = new AdlerChecksum();
            adler.Update("penguin");
            Assert.AreEqual(0x0bcf02f6, adler.Value );

            adler = new AdlerChecksum(1);
            adler.Update("penguin");
            Assert.AreEqual(0x0bd602f7, adler.Value);

        ***REMOVED***
        #endregion
    ***REMOVED***

    [TestFixture]
    public class InfoTests
    ***REMOVED***
        #region Info tests
        [Test]
        public void Info_Version()
        ***REMOVED***
            Info info = new Info();
            Assert.AreEqual("1.2.11", Info.Version);
            Assert.AreEqual(32, info.SizeOfUInt);
            Assert.AreEqual(32, info.SizeOfULong);
            Assert.AreEqual(32, info.SizeOfPointer);
            Assert.AreEqual(32, info.SizeOfOffset);
        ***REMOVED***
        #endregion
    ***REMOVED***

    [TestFixture]
    public class DeflateInflateTests
    ***REMOVED***
        #region Deflate tests
        [Test]
        public void Deflate_Init()
        ***REMOVED***
            using (Deflater def = new Deflater(CompressLevel.Default))
            ***REMOVED***
            ***REMOVED***
        ***REMOVED***

        private ArrayList compressedData = new ArrayList();
        private uint adler1;

        private ArrayList uncompressedData = new ArrayList();
        private uint adler2;

        public void CDataAvail(byte[] data, int startIndex, int count)
        ***REMOVED***
            for (int i = 0; i < count; ++i)
                compressedData.Add(data[i+startIndex]);
        ***REMOVED***

        [Test]
        public void Deflate_Compress()
        ***REMOVED***
            compressedData.Clear();

            byte[] testData = new byte[35000];
            for (int i = 0; i < testData.Length; ++i)
                testData[i] = 5;

            using (Deflater def = new Deflater((CompressLevel)5))
            ***REMOVED***
                def.DataAvailable += new DataAvailableHandler(CDataAvail);
                def.Add(testData);
                def.Finish();
                adler1 = def.Checksum;
            ***REMOVED***
        ***REMOVED***
        #endregion

        #region Inflate tests
        [Test]
        public void Inflate_Init()
        ***REMOVED***
            using (Inflater inf = new Inflater())
            ***REMOVED***
            ***REMOVED***
        ***REMOVED***

        private void DDataAvail(byte[] data, int startIndex, int count)
        ***REMOVED***
            for (int i = 0; i < count; ++i)
                uncompressedData.Add(data[i+startIndex]);
        ***REMOVED***

        [Test]
        public void Inflate_Expand()
        ***REMOVED***
            uncompressedData.Clear();

            using (Inflater inf = new Inflater())
            ***REMOVED***
                inf.DataAvailable += new DataAvailableHandler(DDataAvail);
                inf.Add((byte[])compressedData.ToArray(typeof(byte)));
                inf.Finish();
                adler2 = inf.Checksum;
            ***REMOVED***
            Assert.AreEqual( adler1, adler2 );
        ***REMOVED***
        #endregion
    ***REMOVED***

    [TestFixture]
    public class GZipStreamTests
    ***REMOVED***
        #region GZipStream test
        [Test]
        public void GZipStream_WriteRead()
        ***REMOVED***
            using (GZipStream gzOut = new GZipStream("gzstream.gz", CompressLevel.Best))
            ***REMOVED***
                BinaryWriter writer = new BinaryWriter(gzOut);
                writer.Write("hi there");
                writer.Write(Math.PI);
                writer.Write(42);
            ***REMOVED***

            using (GZipStream gzIn = new GZipStream("gzstream.gz"))
            ***REMOVED***
                BinaryReader reader = new BinaryReader(gzIn);
                string s = reader.ReadString();
                Assert.AreEqual("hi there",s);
                double d = reader.ReadDouble();
                Assert.AreEqual(Math.PI, d);
                int i = reader.ReadInt32();
                Assert.AreEqual(42,i);
            ***REMOVED***

        ***REMOVED***
        #endregion
	***REMOVED***
***REMOVED***

#endif
