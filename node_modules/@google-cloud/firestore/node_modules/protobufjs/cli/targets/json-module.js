"use strict";
module.exports = json_module;

var util = require("../util");

var protobuf = require("../..");

json_module.description = "JSON representation as a module";

function jsonSafeProp(json) ***REMOVED***
    return json.replace(/^( +)"(\w+)":/mg, function($0, $1, $2) ***REMOVED***
        return protobuf.util.safeProp($2).charAt(0) === "."
            ? $1 + $2 + ":"
            : $0;
    ***REMOVED***);
***REMOVED***

function json_module(root, options, callback) ***REMOVED***
    try ***REMOVED***
        var rootProp = protobuf.util.safeProp(options.root || "default");
        var output = [
            (options.es6 ? "const" : "var") + " $root = ($protobuf.roots" + rootProp + " || ($protobuf.roots" + rootProp + " = new $protobuf.Root()))\n"
        ];
        if (root.options) ***REMOVED***
            var optionsJson = jsonSafeProp(JSON.stringify(root.options, null, 2));
            output.push(".setOptions(" + optionsJson + ")\n");
        ***REMOVED***
        var json = jsonSafeProp(JSON.stringify(root.nested, null, 2).trim());
        output.push(".addJSON(" + json + ");");
        output = util.wrap(output.join(""), protobuf.util.merge(***REMOVED*** dependency: "protobufjs/light" ***REMOVED***, options));
        process.nextTick(function() ***REMOVED***
            callback(null, output);
        ***REMOVED***);
    ***REMOVED*** catch (e) ***REMOVED***
        return callback(e);
    ***REMOVED***
    return undefined;
***REMOVED***
