var nopt = require("../")
  , test = require('tap').test
  , isWin = process.platform === 'win32'

test("passing a string results in a string", function (t) ***REMOVED***
  var parsed = nopt(***REMOVED*** key: String ***REMOVED***, ***REMOVED******REMOVED***, ["--key", "myvalue"], 0)
  t.same(parsed.key, "myvalue")
  t.end()
***REMOVED***)

// https://github.com/npm/nopt/issues/31
test("Empty String results in empty string, not true", function (t) ***REMOVED***
  var parsed = nopt(***REMOVED*** empty: String ***REMOVED***, ***REMOVED******REMOVED***, ["--empty"], 0)
  t.same(parsed.empty, "")
  t.end()
***REMOVED***)

// https://github.com/npm/nopt/issues/65
test("Empty String should not swallow next flag", function (t) ***REMOVED***
  var parsed = nopt(***REMOVED*** empty: String, foo: String ***REMOVED***, ***REMOVED******REMOVED***, ["--empty", "--foo"], 0)
  t.same(parsed.empty, "")
  t.same(parsed.foo, "")
  t.end()
***REMOVED***)

// https://github.com/npm/nopt/issues/66
test("Empty String should not be true when type is single item Array", function (t) ***REMOVED***
  var parsed = nopt(***REMOVED***	'foo': [String] ***REMOVED***, ***REMOVED******REMOVED***, ["--foo"], 0)
  t.same(parsed.foo, "")
  t.end()
***REMOVED***)

test("~ path is resolved to " + (isWin ? '%USERPROFILE%' : '$HOME'), function (t) ***REMOVED***
  var path = require("path")
    , the

  if (isWin) ***REMOVED***
    the = ***REMOVED***
      key: 'USERPROFILE',
      dir: 'C:\\temp',
      val: '~\\val'
    ***REMOVED***
  ***REMOVED*** else ***REMOVED***
    the = ***REMOVED***
      key: 'HOME',
      dir: '/tmp',
      val: '~/val'
    ***REMOVED***
  ***REMOVED***
  if (!process.env[the.key]) process.env[the.key] = v.dir
  var parsed = nopt(***REMOVED***key: path***REMOVED***, ***REMOVED******REMOVED***, ["--key=" + the.val], 0)
  t.same(parsed.key, path.resolve(process.env[the.key], "val"))
  t.end()
***REMOVED***)

// https://github.com/npm/nopt/issues/24
test("Unknown options are not parsed as numbers", function (t) ***REMOVED***
    var parsed = nopt(***REMOVED***"parse-me": Number***REMOVED***, null, ['--leave-as-is=1.20', '--parse-me=1.20'], 0)
    t.equal(parsed['leave-as-is'], '1.20')
    t.equal(parsed['parse-me'], 1.2)
    t.end()
***REMOVED***);

// https://github.com/npm/nopt/issues/48
test("Check types based on name of type", function (t) ***REMOVED***
  var parsed = nopt(***REMOVED***"parse-me": ***REMOVED***name: "Number"***REMOVED******REMOVED***, null, ['--parse-me=1.20'], 0)
  t.equal(parsed['parse-me'], 1.2)
  t.end()
***REMOVED***)


test("Missing types are not parsed", function (t) ***REMOVED***
  var parsed = nopt(***REMOVED***"parse-me": ***REMOVED******REMOVED******REMOVED***, null, ['--parse-me=1.20'], 0)
  //should only contain argv
  t.equal(Object.keys(parsed).length, 1)
  t.end()
***REMOVED***)

test("Types passed without a name are not parsed", function (t) ***REMOVED***
  var parsed = nopt(***REMOVED***"parse-me": ***REMOVED******REMOVED******REMOVED***, ***REMOVED******REMOVED***, ['--parse-me=1.20'], 0)
  //should only contain argv
  t.equal(Object.keys(parsed).length, 1)
  t.end()
***REMOVED***)

test("other tests", function (t) ***REMOVED***

  var util = require("util")
    , Stream = require("stream")
    , path = require("path")
    , url = require("url")

    , shorthands =
      ***REMOVED*** s : ["--loglevel", "silent"]
      , d : ["--loglevel", "info"]
      , dd : ["--loglevel", "verbose"]
      , ddd : ["--loglevel", "silly"]
      , noreg : ["--no-registry"]
      , reg : ["--registry"]
      , "no-reg" : ["--no-registry"]
      , silent : ["--loglevel", "silent"]
      , verbose : ["--loglevel", "verbose"]
      , h : ["--usage"]
      , H : ["--usage"]
      , "?" : ["--usage"]
      , help : ["--usage"]
      , v : ["--version"]
      , f : ["--force"]
      , desc : ["--description"]
      , "no-desc" : ["--no-description"]
      , "local" : ["--no-global"]
      , l : ["--long"]
      , p : ["--parseable"]
      , porcelain : ["--parseable"]
      , g : ["--global"]
      ***REMOVED***

    , types =
      ***REMOVED*** aoa: Array
      , nullstream: [null, Stream]
      , date: Date
      , str: String
      , browser : String
      , cache : path
      , color : ["always", Boolean]
      , depth : Number
      , description : Boolean
      , dev : Boolean
      , editor : path
      , force : Boolean
      , global : Boolean
      , globalconfig : path
      , group : [String, Number]
      , gzipbin : String
      , logfd : [Number, Stream]
      , loglevel : ["silent","win","error","warn","info","verbose","silly"]
      , long : Boolean
      , "node-version" : [false, String]
      , npaturl : url
      , npat : Boolean
      , "onload-script" : [false, String]
      , outfd : [Number, Stream]
      , parseable : Boolean
      , pre: Boolean
      , prefix: path
      , proxy : url
      , "rebuild-bundle" : Boolean
      , registry : url
      , searchopts : String
      , searchexclude: [null, String]
      , shell : path
      , t: [Array, String]
      , tag : String
      , tar : String
      , tmp : path
      , "unsafe-perm" : Boolean
      , usage : Boolean
      , user : String
      , username : String
      , userconfig : path
      , version : Boolean
      , viewer: path
      , _exit : Boolean
      , path: path
      ***REMOVED***

  ; [["-v", ***REMOVED***version:true***REMOVED***, []]
    ,["---v", ***REMOVED***version:true***REMOVED***, []]
    ,["ls -s --no-reg connect -d",
      ***REMOVED***loglevel:"info",registry:null***REMOVED***,["ls","connect"]]
    ,["ls ---s foo",***REMOVED***loglevel:"silent"***REMOVED***,["ls","foo"]]
    ,["ls --registry blargle", ***REMOVED******REMOVED***, ["ls"]]
    ,["--no-registry", ***REMOVED***registry:null***REMOVED***, []]
    ,["--no-color true", ***REMOVED***color:false***REMOVED***, []]
    ,["--no-color false", ***REMOVED***color:true***REMOVED***, []]
    ,["--no-color", ***REMOVED***color:false***REMOVED***, []]
    ,["--color false", ***REMOVED***color:false***REMOVED***, []]
    ,["--color --logfd 7", ***REMOVED***logfd:7,color:true***REMOVED***, []]
    ,["--color=true", ***REMOVED***color:true***REMOVED***, []]
    ,["--logfd=10", ***REMOVED***logfd:10***REMOVED***, []]
    ,["--tmp=/tmp -tar=gtar", ***REMOVED***tmp: isWin ? "C:\\tmp" : "/tmp",tar:"gtar"***REMOVED***,[]]
    ,["--tmp=tmp -tar=gtar",
      ***REMOVED***tmp:path.resolve(process.cwd(), "tmp"),tar:"gtar"***REMOVED***,[]]
    ,["--logfd x", ***REMOVED******REMOVED***, []]
    ,["a -true -- -no-false", ***REMOVED***true:true***REMOVED***,["a","-no-false"]]
    ,["a -no-false", ***REMOVED***false:false***REMOVED***,["a"]]
    ,["a -no-no-true", ***REMOVED***true:true***REMOVED***, ["a"]]
    ,["a -no-no-no-false", ***REMOVED***false:false***REMOVED***, ["a"]]
    ,["---NO-no-No-no-no-no-nO-no-no"+
      "-No-no-no-no-no-no-no-no-no"+
      "-no-no-no-no-NO-NO-no-no-no-no-no-no"+
      "-no-body-can-do-the-boogaloo-like-I-do"
     ,***REMOVED***"body-can-do-the-boogaloo-like-I-do":false***REMOVED***, []]
    ,["we are -no-strangers-to-love "+
      "--you-know=the-rules --and=so-do-i "+
      "---im-thinking-of=a-full-commitment "+
      "--no-you-would-get-this-from-any-other-guy "+
      "--no-gonna-give-you-up "+
      "-no-gonna-let-you-down=true "+
      "--no-no-gonna-run-around false "+
      "--desert-you=false "+
      "--make-you-cry false "+
      "--no-tell-a-lie "+
      "--no-no-and-hurt-you false"
     ,***REMOVED***"strangers-to-love":false
      ,"you-know":"the-rules"
      ,"and":"so-do-i"
      ,"you-would-get-this-from-any-other-guy":false
      ,"gonna-give-you-up":false
      ,"gonna-let-you-down":false
      ,"gonna-run-around":false
      ,"desert-you":false
      ,"make-you-cry":false
      ,"tell-a-lie":false
      ,"and-hurt-you":false
      ***REMOVED***,["we", "are"]]
    ,["-t one -t two -t three"
     ,***REMOVED***t: ["one", "two", "three"]***REMOVED***
     ,[]]
    ,["-t one -t null -t three four five null"
     ,***REMOVED***t: ["one", "null", "three"]***REMOVED***
     ,["four", "five", "null"]]
    ,["-t foo"
     ,***REMOVED***t:["foo"]***REMOVED***
     ,[]]
    ,["--no-t"
     ,***REMOVED***t:["false"]***REMOVED***
     ,[]]
    ,["-no-no-t"
     ,***REMOVED***t:["true"]***REMOVED***
     ,[]]
    ,["-aoa one -aoa null -aoa 100"
     ,***REMOVED***aoa:["one", null, '100']***REMOVED***
     ,[]]
    ,["-str 100"
     ,***REMOVED***str:"100"***REMOVED***
     ,[]]
    ,["--color always"
     ,***REMOVED***color:"always"***REMOVED***
     ,[]]
    ,["--no-nullstream"
     ,***REMOVED***nullstream:null***REMOVED***
     ,[]]
    ,["--nullstream false"
     ,***REMOVED***nullstream:null***REMOVED***
     ,[]]
    ,["--notadate=2011-01-25"
     ,***REMOVED***notadate: "2011-01-25"***REMOVED***
     ,[]]
    ,["--date 2011-01-25"
     ,***REMOVED***date: new Date("2011-01-25")***REMOVED***
     ,[]]
    ,["-cl 1"
     ,***REMOVED***config: true, length: 1***REMOVED***
     ,[]
     ,***REMOVED***config: Boolean, length: Number, clear: Boolean***REMOVED***
     ,***REMOVED***c: "--config", l: "--length"***REMOVED***]
    ,["--acount bla"
     ,***REMOVED***"acount":true***REMOVED***
     ,["bla"]
     ,***REMOVED***account: Boolean, credentials: Boolean, options: String***REMOVED***
     ,***REMOVED***a:"--account", c:"--credentials",o:"--options"***REMOVED***]
    ,["--clear"
     ,***REMOVED***clear:true***REMOVED***
     ,[]
     ,***REMOVED***clear:Boolean,con:Boolean,len:Boolean,exp:Boolean,add:Boolean,rep:Boolean***REMOVED***
     ,***REMOVED***c:"--con",l:"--len",e:"--exp",a:"--add",r:"--rep"***REMOVED***]
    ,["--file -"
     ,***REMOVED***"file":"-"***REMOVED***
     ,[]
     ,***REMOVED***file:String***REMOVED***
     ,***REMOVED******REMOVED***]
    ,["--file -"
     ,***REMOVED***"file":true***REMOVED***
     ,["-"]
     ,***REMOVED***file:Boolean***REMOVED***
     ,***REMOVED******REMOVED***]
    ,["--path"
     ,***REMOVED***"path":null***REMOVED***
     ,[]]
    ,["--path ."
     ,***REMOVED***"path":process.cwd()***REMOVED***
     ,[]]
    ].forEach(function (test) ***REMOVED***
      var argv = test[0].split(/\s+/)
        , opts = test[1]
        , rem = test[2]
        , actual = nopt(test[3] || types, test[4] || shorthands, argv, 0)
        , parsed = actual.argv
      delete actual.argv
      for (var i in opts) ***REMOVED***
        var e = JSON.stringify(opts[i])
          , a = JSON.stringify(actual[i] === undefined ? null : actual[i])
        if (e && typeof e === "object") ***REMOVED***
          t.deepEqual(e, a)
        ***REMOVED*** else ***REMOVED***
          t.equal(e, a)
        ***REMOVED***
      ***REMOVED***
      t.deepEqual(rem, parsed.remain)
    ***REMOVED***)
  t.end()
***REMOVED***)
