'use strict';
module.exports = function generate_validate(it, $keyword) ***REMOVED***
  var out = '';
  var $async = it.schema.$async === true;
  if (it.isTop) ***REMOVED***
    var $top = it.isTop,
      $lvl = it.level = 0,
      $dataLvl = it.dataLevel = 0,
      $data = 'data';
    it.rootId = it.resolve.fullPath(it.root.schema.id);
    it.baseId = it.baseId || it.rootId;
    if ($async) ***REMOVED***
      it.async = true;
      var $es7 = it.opts.async == 'es7';
      it.yieldAwait = $es7 ? 'await' : 'yield';
    ***REMOVED***
    delete it.isTop;
    it.dataPathArr = [undefined];
    out += ' var validate = ';
    if ($async) ***REMOVED***
      if ($es7) ***REMOVED***
        out += ' (async function ';
      ***REMOVED*** else ***REMOVED***
        if (it.opts.async == 'co*') ***REMOVED***
          out += 'co.wrap';
        ***REMOVED***
        out += '(function* ';
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      out += ' (function ';
    ***REMOVED***
    out += ' (data, dataPath, parentData, parentDataProperty, rootData) ***REMOVED*** \'use strict\'; var vErrors = null; ';
    out += ' var errors = 0;     ';
    out += ' if (rootData === undefined) rootData = data;';
  ***REMOVED*** else ***REMOVED***
    var $lvl = it.level,
      $dataLvl = it.dataLevel,
      $data = 'data' + ($dataLvl || '');
    if (it.schema.id) it.baseId = it.resolve.url(it.baseId, it.schema.id);
    if ($async && !it.async) throw new Error('async schema in sync schema');
    out += ' var errs_' + ($lvl) + ' = errors;';
  ***REMOVED***
  var $valid = 'valid' + $lvl,
    $breakOnError = !it.opts.allErrors,
    $closingBraces1 = '',
    $closingBraces2 = '';
  var $typeSchema = it.schema.type,
    $typeIsArray = Array.isArray($typeSchema);
  if ($typeSchema && it.opts.coerceTypes) ***REMOVED***
    var $coerceToTypes = it.util.coerceToTypes(it.opts.coerceTypes, $typeSchema);
    if ($coerceToTypes) ***REMOVED***
      var $schemaPath = it.schemaPath + '.type',
        $errSchemaPath = it.errSchemaPath + '/type',
        $method = $typeIsArray ? 'checkDataTypes' : 'checkDataType';
      out += ' if (' + (it.util[$method]($typeSchema, $data, true)) + ') ***REMOVED***  ';
      var $dataType = 'dataType' + $lvl,
        $coerced = 'coerced' + $lvl;
      out += ' var ' + ($dataType) + ' = typeof ' + ($data) + '; ';
      if (it.opts.coerceTypes == 'array') ***REMOVED***
        out += ' if (' + ($dataType) + ' == \'object\' && Array.isArray(' + ($data) + ')) ' + ($dataType) + ' = \'array\'; ';
      ***REMOVED***
      out += ' var ' + ($coerced) + ' = undefined; ';
      var $bracesCoercion = '';
      var arr1 = $coerceToTypes;
      if (arr1) ***REMOVED***
        var $type, $i = -1,
          l1 = arr1.length - 1;
        while ($i < l1) ***REMOVED***
          $type = arr1[$i += 1];
          if ($i) ***REMOVED***
            out += ' if (' + ($coerced) + ' === undefined) ***REMOVED*** ';
            $bracesCoercion += '***REMOVED***';
          ***REMOVED***
          if (it.opts.coerceTypes == 'array' && $type != 'array') ***REMOVED***
            out += ' if (' + ($dataType) + ' == \'array\' && ' + ($data) + '.length == 1) ***REMOVED*** ' + ($coerced) + ' = ' + ($data) + ' = ' + ($data) + '[0]; ' + ($dataType) + ' = typeof ' + ($data) + ';  ***REMOVED*** ';
          ***REMOVED***
          if ($type == 'string') ***REMOVED***
            out += ' if (' + ($dataType) + ' == \'number\' || ' + ($dataType) + ' == \'boolean\') ' + ($coerced) + ' = \'\' + ' + ($data) + '; else if (' + ($data) + ' === null) ' + ($coerced) + ' = \'\'; ';
          ***REMOVED*** else if ($type == 'number' || $type == 'integer') ***REMOVED***
            out += ' if (' + ($dataType) + ' == \'boolean\' || ' + ($data) + ' === null || (' + ($dataType) + ' == \'string\' && ' + ($data) + ' && ' + ($data) + ' == +' + ($data) + ' ';
            if ($type == 'integer') ***REMOVED***
              out += ' && !(' + ($data) + ' % 1)';
            ***REMOVED***
            out += ')) ' + ($coerced) + ' = +' + ($data) + '; ';
          ***REMOVED*** else if ($type == 'boolean') ***REMOVED***
            out += ' if (' + ($data) + ' === \'false\' || ' + ($data) + ' === 0 || ' + ($data) + ' === null) ' + ($coerced) + ' = false; else if (' + ($data) + ' === \'true\' || ' + ($data) + ' === 1) ' + ($coerced) + ' = true; ';
          ***REMOVED*** else if ($type == 'null') ***REMOVED***
            out += ' if (' + ($data) + ' === \'\' || ' + ($data) + ' === 0 || ' + ($data) + ' === false) ' + ($coerced) + ' = null; ';
          ***REMOVED*** else if (it.opts.coerceTypes == 'array' && $type == 'array') ***REMOVED***
            out += ' if (' + ($dataType) + ' == \'string\' || ' + ($dataType) + ' == \'number\' || ' + ($dataType) + ' == \'boolean\' || ' + ($data) + ' == null) ' + ($coerced) + ' = [' + ($data) + ']; ';
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***
      out += ' ' + ($bracesCoercion) + ' if (' + ($coerced) + ' === undefined) ***REMOVED***   ';
      var $$outStack = $$outStack || [];
      $$outStack.push(out);
      out = ''; /* istanbul ignore else */
      if (it.createErrors !== false) ***REMOVED***
        out += ' ***REMOVED*** keyword: \'' + ('type') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED*** type: \'';
        if ($typeIsArray) ***REMOVED***
          out += '' + ($typeSchema.join(","));
        ***REMOVED*** else ***REMOVED***
          out += '' + ($typeSchema);
        ***REMOVED***
        out += '\' ***REMOVED*** ';
        if (it.opts.messages !== false) ***REMOVED***
          out += ' , message: \'should be ';
          if ($typeIsArray) ***REMOVED***
            out += '' + ($typeSchema.join(","));
          ***REMOVED*** else ***REMOVED***
            out += '' + ($typeSchema);
          ***REMOVED***
          out += '\' ';
        ***REMOVED***
        if (it.opts.verbose) ***REMOVED***
          out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
        ***REMOVED***
        out += ' ***REMOVED*** ';
      ***REMOVED*** else ***REMOVED***
        out += ' ***REMOVED******REMOVED*** ';
      ***REMOVED***
      var __err = out;
      out = $$outStack.pop();
      if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
        if (it.async) ***REMOVED***
          out += ' throw new ValidationError([' + (__err) + ']); ';
        ***REMOVED*** else ***REMOVED***
          out += ' validate.errors = [' + (__err) + ']; return false; ';
        ***REMOVED***
      ***REMOVED*** else ***REMOVED***
        out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
      ***REMOVED***
      out += ' ***REMOVED*** else ***REMOVED***  ';
      var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',
        $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';
      out += ' ' + ($data) + ' = ' + ($coerced) + '; ';
      if (!$dataLvl) ***REMOVED***
        out += 'if (' + ($parentData) + ' !== undefined)';
      ***REMOVED***
      out += ' ' + ($parentData) + '[' + ($parentDataProperty) + '] = ' + ($coerced) + '; ***REMOVED*** ***REMOVED*** ';
    ***REMOVED***
  ***REMOVED***
  var $refKeywords;
  if (it.schema.$ref && ($refKeywords = it.util.schemaHasRulesExcept(it.schema, it.RULES.all, '$ref'))) ***REMOVED***
    if (it.opts.extendRefs == 'fail') ***REMOVED***
      throw new Error('$ref: validation keywords used in schema at path "' + it.errSchemaPath + '"');
    ***REMOVED*** else if (it.opts.extendRefs == 'ignore') ***REMOVED***
      $refKeywords = false;
      console.log('$ref: keywords ignored in schema at path "' + it.errSchemaPath + '"');
    ***REMOVED*** else if (it.opts.extendRefs !== true) ***REMOVED***
      console.log('$ref: all keywords used in schema at path "' + it.errSchemaPath + '". It will change in the next major version, see issue #260. Use option ***REMOVED*** extendRefs: true ***REMOVED*** to keep current behaviour');
    ***REMOVED***
  ***REMOVED***
  if (it.schema.$ref && !$refKeywords) ***REMOVED***
    out += ' ' + (it.RULES.all.$ref.code(it, '$ref')) + ' ';
    if ($breakOnError) ***REMOVED***
      out += ' ***REMOVED*** if (errors === ';
      if ($top) ***REMOVED***
        out += '0';
      ***REMOVED*** else ***REMOVED***
        out += 'errs_' + ($lvl);
      ***REMOVED***
      out += ') ***REMOVED*** ';
      $closingBraces2 += '***REMOVED***';
    ***REMOVED***
  ***REMOVED*** else ***REMOVED***
    var arr2 = it.RULES;
    if (arr2) ***REMOVED***
      var $rulesGroup, i2 = -1,
        l2 = arr2.length - 1;
      while (i2 < l2) ***REMOVED***
        $rulesGroup = arr2[i2 += 1];
        if ($shouldUseGroup($rulesGroup)) ***REMOVED***
          if ($rulesGroup.type) ***REMOVED***
            out += ' if (' + (it.util.checkDataType($rulesGroup.type, $data)) + ') ***REMOVED*** ';
          ***REMOVED***
          if (it.opts.useDefaults && !it.compositeRule) ***REMOVED***
            if ($rulesGroup.type == 'object' && it.schema.properties) ***REMOVED***
              var $schema = it.schema.properties,
                $schemaKeys = Object.keys($schema);
              var arr3 = $schemaKeys;
              if (arr3) ***REMOVED***
                var $propertyKey, i3 = -1,
                  l3 = arr3.length - 1;
                while (i3 < l3) ***REMOVED***
                  $propertyKey = arr3[i3 += 1];
                  var $sch = $schema[$propertyKey];
                  if ($sch.default !== undefined) ***REMOVED***
                    var $passData = $data + it.util.getProperty($propertyKey);
                    out += '  if (' + ($passData) + ' === undefined) ' + ($passData) + ' = ';
                    if (it.opts.useDefaults == 'shared') ***REMOVED***
                      out += ' ' + (it.useDefault($sch.default)) + ' ';
                    ***REMOVED*** else ***REMOVED***
                      out += ' ' + (JSON.stringify($sch.default)) + ' ';
                    ***REMOVED***
                    out += '; ';
                  ***REMOVED***
                ***REMOVED***
              ***REMOVED***
            ***REMOVED*** else if ($rulesGroup.type == 'array' && Array.isArray(it.schema.items)) ***REMOVED***
              var arr4 = it.schema.items;
              if (arr4) ***REMOVED***
                var $sch, $i = -1,
                  l4 = arr4.length - 1;
                while ($i < l4) ***REMOVED***
                  $sch = arr4[$i += 1];
                  if ($sch.default !== undefined) ***REMOVED***
                    var $passData = $data + '[' + $i + ']';
                    out += '  if (' + ($passData) + ' === undefined) ' + ($passData) + ' = ';
                    if (it.opts.useDefaults == 'shared') ***REMOVED***
                      out += ' ' + (it.useDefault($sch.default)) + ' ';
                    ***REMOVED*** else ***REMOVED***
                      out += ' ' + (JSON.stringify($sch.default)) + ' ';
                    ***REMOVED***
                    out += '; ';
                  ***REMOVED***
                ***REMOVED***
              ***REMOVED***
            ***REMOVED***
          ***REMOVED***
          var arr5 = $rulesGroup.rules;
          if (arr5) ***REMOVED***
            var $rule, i5 = -1,
              l5 = arr5.length - 1;
            while (i5 < l5) ***REMOVED***
              $rule = arr5[i5 += 1];
              if ($shouldUseRule($rule)) ***REMOVED***
                out += ' ' + ($rule.code(it, $rule.keyword)) + ' ';
                if ($breakOnError) ***REMOVED***
                  $closingBraces1 += '***REMOVED***';
                ***REMOVED***
              ***REMOVED***
            ***REMOVED***
          ***REMOVED***
          if ($breakOnError) ***REMOVED***
            out += ' ' + ($closingBraces1) + ' ';
            $closingBraces1 = '';
          ***REMOVED***
          if ($rulesGroup.type) ***REMOVED***
            out += ' ***REMOVED*** ';
            if ($typeSchema && $typeSchema === $rulesGroup.type && !$coerceToTypes) ***REMOVED***
              var $typeChecked = true;
              out += ' else ***REMOVED*** ';
              var $schemaPath = it.schemaPath + '.type',
                $errSchemaPath = it.errSchemaPath + '/type';
              var $$outStack = $$outStack || [];
              $$outStack.push(out);
              out = ''; /* istanbul ignore else */
              if (it.createErrors !== false) ***REMOVED***
                out += ' ***REMOVED*** keyword: \'' + ('type') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED*** type: \'';
                if ($typeIsArray) ***REMOVED***
                  out += '' + ($typeSchema.join(","));
                ***REMOVED*** else ***REMOVED***
                  out += '' + ($typeSchema);
                ***REMOVED***
                out += '\' ***REMOVED*** ';
                if (it.opts.messages !== false) ***REMOVED***
                  out += ' , message: \'should be ';
                  if ($typeIsArray) ***REMOVED***
                    out += '' + ($typeSchema.join(","));
                  ***REMOVED*** else ***REMOVED***
                    out += '' + ($typeSchema);
                  ***REMOVED***
                  out += '\' ';
                ***REMOVED***
                if (it.opts.verbose) ***REMOVED***
                  out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
                ***REMOVED***
                out += ' ***REMOVED*** ';
              ***REMOVED*** else ***REMOVED***
                out += ' ***REMOVED******REMOVED*** ';
              ***REMOVED***
              var __err = out;
              out = $$outStack.pop();
              if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
                if (it.async) ***REMOVED***
                  out += ' throw new ValidationError([' + (__err) + ']); ';
                ***REMOVED*** else ***REMOVED***
                  out += ' validate.errors = [' + (__err) + ']; return false; ';
                ***REMOVED***
              ***REMOVED*** else ***REMOVED***
                out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
              ***REMOVED***
              out += ' ***REMOVED*** ';
            ***REMOVED***
          ***REMOVED***
          if ($breakOnError) ***REMOVED***
            out += ' if (errors === ';
            if ($top) ***REMOVED***
              out += '0';
            ***REMOVED*** else ***REMOVED***
              out += 'errs_' + ($lvl);
            ***REMOVED***
            out += ') ***REMOVED*** ';
            $closingBraces2 += '***REMOVED***';
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***
    ***REMOVED***
  ***REMOVED***
  if ($typeSchema && !$typeChecked && !$coerceToTypes) ***REMOVED***
    var $schemaPath = it.schemaPath + '.type',
      $errSchemaPath = it.errSchemaPath + '/type',
      $method = $typeIsArray ? 'checkDataTypes' : 'checkDataType';
    out += ' if (' + (it.util[$method]($typeSchema, $data, true)) + ') ***REMOVED***   ';
    var $$outStack = $$outStack || [];
    $$outStack.push(out);
    out = ''; /* istanbul ignore else */
    if (it.createErrors !== false) ***REMOVED***
      out += ' ***REMOVED*** keyword: \'' + ('type') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED*** type: \'';
      if ($typeIsArray) ***REMOVED***
        out += '' + ($typeSchema.join(","));
      ***REMOVED*** else ***REMOVED***
        out += '' + ($typeSchema);
      ***REMOVED***
      out += '\' ***REMOVED*** ';
      if (it.opts.messages !== false) ***REMOVED***
        out += ' , message: \'should be ';
        if ($typeIsArray) ***REMOVED***
          out += '' + ($typeSchema.join(","));
        ***REMOVED*** else ***REMOVED***
          out += '' + ($typeSchema);
        ***REMOVED***
        out += '\' ';
      ***REMOVED***
      if (it.opts.verbose) ***REMOVED***
        out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
      ***REMOVED***
      out += ' ***REMOVED*** ';
    ***REMOVED*** else ***REMOVED***
      out += ' ***REMOVED******REMOVED*** ';
    ***REMOVED***
    var __err = out;
    out = $$outStack.pop();
    if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
      if (it.async) ***REMOVED***
        out += ' throw new ValidationError([' + (__err) + ']); ';
      ***REMOVED*** else ***REMOVED***
        out += ' validate.errors = [' + (__err) + ']; return false; ';
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
    ***REMOVED***
    out += ' ***REMOVED***';
  ***REMOVED***
  if ($breakOnError) ***REMOVED***
    out += ' ' + ($closingBraces2) + ' ';
  ***REMOVED***
  if ($top) ***REMOVED***
    if ($async) ***REMOVED***
      out += ' if (errors === 0) return true;           ';
      out += ' else throw new ValidationError(vErrors); ';
    ***REMOVED*** else ***REMOVED***
      out += ' validate.errors = vErrors; ';
      out += ' return errors === 0;       ';
    ***REMOVED***
    out += ' ***REMOVED***); return validate;';
  ***REMOVED*** else ***REMOVED***
    out += ' var ' + ($valid) + ' = errors === errs_' + ($lvl) + ';';
  ***REMOVED***
  out = it.util.cleanUpCode(out);
  if ($top && $breakOnError) ***REMOVED***
    out = it.util.cleanUpVarErrors(out, $async);
  ***REMOVED***

  function $shouldUseGroup($rulesGroup) ***REMOVED***
    for (var i = 0; i < $rulesGroup.rules.length; i++)
      if ($shouldUseRule($rulesGroup.rules[i])) return true;
  ***REMOVED***

  function $shouldUseRule($rule) ***REMOVED***
    return it.schema[$rule.keyword] !== undefined || ($rule.keyword == 'properties' && (it.schema.additionalProperties === false || typeof it.schema.additionalProperties == 'object' || (it.schema.patternProperties && Object.keys(it.schema.patternProperties).length) || (it.opts.v5 && it.schema.patternGroups && Object.keys(it.schema.patternGroups).length)));
  ***REMOVED***
  return out;
***REMOVED***
