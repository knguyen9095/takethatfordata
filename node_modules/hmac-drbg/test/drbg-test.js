'use strict';

const assert = require('assert');
const HmacDRBG = require('../');
const hash = require('hash.js');

describe('Hmac_DRBG', () => ***REMOVED***
  it('should support hmac-drbg-sha256', () => ***REMOVED***
    function doDrbg(opt) ***REMOVED***
      const drbg = HmacDRBG(***REMOVED***
        hash: hash.sha256,
        entropy: opt.entropy,
        entropyEnc: 'utf8',
        nonce: opt.nonce,
        nonceEnc: 'utf8',
        pers: opt.pers,
        persEnc: 'utf8'
      ***REMOVED***);
      return drbg.generate(opt.size, 'hex');
    ***REMOVED***

    const test = [
      ***REMOVED***
        entropy: 'totally random0123456789',
        nonce: 'secret nonce',
        pers: 'my drbg',
        size: 32,
        res: '018ec5f8e08c41e5ac974eb129ac297c5388ee1864324fa13d9b15cf98d9a157'
      ***REMOVED***,
      ***REMOVED***
        entropy: 'totally random0123456789',
        nonce: 'secret nonce',
        pers: null,
        size: 32,
        res: 'ed5d61ecf0ef38258e62f03bbb49f19f2cd07ba5145a840d83b134d5963b3633'
      ***REMOVED***
    ];
    for (let i = 0; i < test.length; i++)
      assert.equal(doDrbg(test[i]), test[i].res);
  ***REMOVED***);

  describe('NIST vector', function() ***REMOVED***
    require('./fixtures/hmac-drbg-nist.json').forEach(function (opt) ***REMOVED***
      it('should not fail at ' + opt.name, function() ***REMOVED***
        const drbg = HmacDRBG(***REMOVED***
          hash: hash.sha256,
          entropy: opt.entropy,
          nonce: opt.nonce,
          pers: opt.pers
        ***REMOVED***);

        let last;
        for (let i = 0; i < opt.add.length; i++) ***REMOVED***
          let add = opt.add[i];
          last = drbg.generate(opt.expected.length / 2, 'hex', add);
        ***REMOVED***
        assert.equal(last, opt.expected);
      ***REMOVED***);
    ***REMOVED***);
  ***REMOVED***);

  describe('reseeding', function() ***REMOVED***
    it('should reseed', function() ***REMOVED***
      const entropy = 'totally random string with many chars that I typed ' +
                      'in agony';
      const nonce = 'nonce';
      const pers = 'pers';

      const original = HmacDRBG(***REMOVED***
        hash: hash.sha256,
        entropy,
        nonce,
        pers
      ***REMOVED***);
      const reseeded = HmacDRBG(***REMOVED***
        hash: hash.sha256,
        entropy,
        nonce,
        pers
      ***REMOVED***);

      assert.strictEqual(original.generate(32, 'hex'),
                         reseeded.generate(32, 'hex'));

      reseeded.reseed('another absolutely random string');

      assert.notEqual(original.generate(32, 'hex'),
                      reseeded.generate(32, 'hex'));
    ***REMOVED***);
  ***REMOVED***);
***REMOVED***);
