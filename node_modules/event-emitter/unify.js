'use strict';

var forEach    = require('es5-ext/object/for-each')
  , validValue = require('es5-ext/object/valid-object')

  , push = Array.prototype.apply, defineProperty = Object.defineProperty
  , create = Object.create, hasOwnProperty = Object.prototype.hasOwnProperty
  , d = ***REMOVED*** configurable: true, enumerable: false, writable: true ***REMOVED***;

module.exports = function (e1, e2) ***REMOVED***
	var data;
	(validValue(e1) && validValue(e2));
	if (!hasOwnProperty.call(e1, '__ee__')) ***REMOVED***
		if (!hasOwnProperty.call(e2, '__ee__')) ***REMOVED***
			d.value = create(null);
			defineProperty(e1, '__ee__', d);
			defineProperty(e2, '__ee__', d);
			d.value = null;
			return;
		***REMOVED***
		d.value = e2.__ee__;
		defineProperty(e1, '__ee__', d);
		d.value = null;
		return;
	***REMOVED***
	data = d.value = e1.__ee__;
	if (!hasOwnProperty.call(e2, '__ee__')) ***REMOVED***
		defineProperty(e2, '__ee__', d);
		d.value = null;
		return;
	***REMOVED***
	if (data === e2.__ee__) return;
	forEach(e2.__ee__, function (listener, name) ***REMOVED***
		if (!data[name]) ***REMOVED***
			data[name] = listener;
			return;
		***REMOVED***
		if (typeof data[name] === 'object') ***REMOVED***
			if (typeof listener === 'object') push.apply(data[name], listener);
			else data[name].push(listener);
		***REMOVED*** else if (typeof listener === 'object') ***REMOVED***
			listener.unshift(data[name]);
			data[name] = listener;
		***REMOVED*** else ***REMOVED***
			data[name] = [data[name], listener];
		***REMOVED***
	***REMOVED***);
	defineProperty(e2, '__ee__', d);
	d.value = null;
***REMOVED***;
