'use strict';

// Benchmark comparing performance of event emit for single listener
// To run it, do following in memoizee package path:
//
// $ npm install eventemitter2 signals
// $ node benchmark/single-on.js

var forEach    = require('es5-ext/object/for-each')
  , pad        = require('es5-ext/string/#/pad')

  , now = Date.now

  , time, count = 1000000, i, data = ***REMOVED******REMOVED***
  , ee, native, ee2, signals, a = ***REMOVED******REMOVED***, b = ***REMOVED******REMOVED***;

ee = (function () ***REMOVED***
	var ee = require('../');
	return ee().on('test', function () ***REMOVED*** return arguments; ***REMOVED***);
***REMOVED***());

native = (function () ***REMOVED***
	var ee = require('events');
	return (new ee.EventEmitter()).on('test', function () ***REMOVED*** return arguments; ***REMOVED***);
***REMOVED***());

ee2 = (function () ***REMOVED***
	var ee = require('eventemitter2');
	return (new ee.EventEmitter2()).on('test', function () ***REMOVED*** return arguments; ***REMOVED***);
***REMOVED***());

signals = (function () ***REMOVED***
	var Signal = require('signals')
	  , ee = ***REMOVED*** test: new Signal() ***REMOVED***;
	ee.test.add(function () ***REMOVED*** return arguments; ***REMOVED***);
	return ee;
***REMOVED***());

console.log("Emit for single listener", "x" + count + ":\n");

i = count;
time = now();
while (i--) ***REMOVED***
	ee.emit('test', a, b);
***REMOVED***
data["event-emitter (this implementation)"] = now() - time;

i = count;
time = now();
while (i--) ***REMOVED***
	native.emit('test', a, b);
***REMOVED***
data["EventEmitter (Node.js native)"] = now() - time;

i = count;
time = now();
while (i--) ***REMOVED***
	ee2.emit('test', a, b);
***REMOVED***
data.EventEmitter2 = now() - time;

i = count;
time = now();
while (i--) ***REMOVED***
	signals.test.dispatch(a, b);
***REMOVED***
data.Signals = now() - time;

forEach(data, function (value, name, obj, index) ***REMOVED***
	console.log(index + 1 + ":",  pad.call(value, " ", 5), name);
***REMOVED***, null, function (a, b) ***REMOVED***
	return this[a] - this[b];
***REMOVED***);
