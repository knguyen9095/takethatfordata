/*********************************************************************
 * NAN - Native Abstractions for Node.js
 *
 * Copyright (c) 2017 NAN contributors
 *
 * MIT License <https://github.com/nodejs/nan/blob/master/LICENSE.md>
 ********************************************************************/

#ifndef NAN_PERSISTENT_12_INL_H_
#define NAN_PERSISTENT_12_INL_H_

template<typename T, typename M> class Persistent :
    public v8::Persistent<T, M> ***REMOVED***
 public:
  inline Persistent() : v8::Persistent<T, M>() ***REMOVED******REMOVED***

  template<typename S> inline Persistent(v8::Local<S> that) :
      v8::Persistent<T, M>(v8::Isolate::GetCurrent(), that) ***REMOVED******REMOVED***

  template<typename S, typename M2>
  inline
  Persistent(const v8::Persistent<S, M2> &that) :  // NOLINT(runtime/explicit)
      v8::Persistent<T, M2>(v8::Isolate::GetCurrent(), that) ***REMOVED******REMOVED***

  inline void Reset() ***REMOVED*** v8::PersistentBase<T>::Reset(); ***REMOVED***

  template <typename S>
  inline void Reset(const v8::Local<S> &other) ***REMOVED***
    v8::PersistentBase<T>::Reset(v8::Isolate::GetCurrent(), other);
  ***REMOVED***

  template <typename S>
  inline void Reset(const v8::PersistentBase<S> &other) ***REMOVED***
    v8::PersistentBase<T>::Reset(v8::Isolate::GetCurrent(), other);
  ***REMOVED***

  template<typename P>
  inline void SetWeak(
    P *parameter
    , typename WeakCallbackInfo<P>::Callback callback
    , WeakCallbackType type);

 private:
  inline T *operator*() const ***REMOVED*** return *PersistentBase<T>::persistent; ***REMOVED***

  template<typename S, typename M2>
  inline void Copy(const Persistent<S, M2> &that) ***REMOVED***
    TYPE_CHECK(T, S);

    this->Reset();

    if (!that.IsEmpty()) ***REMOVED***
      this->Reset(that);
      M::Copy(that, this);
    ***REMOVED***
  ***REMOVED***
***REMOVED***;

#if defined(V8_MAJOR_VERSION) && (V8_MAJOR_VERSION > 4 ||                      \
  (V8_MAJOR_VERSION == 4 && defined(V8_MINOR_VERSION) && V8_MINOR_VERSION >= 3))
template<typename T>
class Global : public v8::Global<T> ***REMOVED***
 public:
  inline Global() : v8::Global<T>() ***REMOVED******REMOVED***

  template<typename S> inline Global(v8::Local<S> that) :
    v8::Global<T>(v8::Isolate::GetCurrent(), that) ***REMOVED******REMOVED***

  template<typename S>
  inline
  Global(const v8::PersistentBase<S> &that) :  // NOLINT(runtime/explicit)
      v8::Global<S>(v8::Isolate::GetCurrent(), that) ***REMOVED******REMOVED***

  inline void Reset() ***REMOVED*** v8::PersistentBase<T>::Reset(); ***REMOVED***

  template <typename S>
  inline void Reset(const v8::Local<S> &other) ***REMOVED***
    v8::PersistentBase<T>::Reset(v8::Isolate::GetCurrent(), other);
  ***REMOVED***

  template <typename S>
  inline void Reset(const v8::PersistentBase<S> &other) ***REMOVED***
    v8::PersistentBase<T>::Reset(v8::Isolate::GetCurrent(), other);
  ***REMOVED***

  template<typename P>
  inline void SetWeak(
    P *parameter
    , typename WeakCallbackInfo<P>::Callback callback
    , WeakCallbackType type) ***REMOVED***
    reinterpret_cast<Persistent<T>*>(this)->SetWeak(
        parameter, callback, type);
  ***REMOVED***
***REMOVED***;
#else
template<typename T>
class Global : public v8::UniquePersistent<T> ***REMOVED***
 public:
  inline Global() : v8::UniquePersistent<T>() ***REMOVED******REMOVED***

  template<typename S> inline Global(v8::Local<S> that) :
    v8::UniquePersistent<T>(v8::Isolate::GetCurrent(), that) ***REMOVED******REMOVED***

  template<typename S>
  inline
  Global(const v8::PersistentBase<S> &that) :  // NOLINT(runtime/explicit)
      v8::UniquePersistent<S>(v8::Isolate::GetCurrent(), that) ***REMOVED******REMOVED***

  inline void Reset() ***REMOVED*** v8::PersistentBase<T>::Reset(); ***REMOVED***

  template <typename S>
  inline void Reset(const v8::Local<S> &other) ***REMOVED***
    v8::PersistentBase<T>::Reset(v8::Isolate::GetCurrent(), other);
  ***REMOVED***

  template <typename S>
  inline void Reset(const v8::PersistentBase<S> &other) ***REMOVED***
    v8::PersistentBase<T>::Reset(v8::Isolate::GetCurrent(), other);
  ***REMOVED***

  template<typename P>
  inline void SetWeak(
    P *parameter
    , typename WeakCallbackInfo<P>::Callback callback
    , WeakCallbackType type) ***REMOVED***
    reinterpret_cast<Persistent<T>*>(this)->SetWeak(
        parameter, callback, type);
  ***REMOVED***
***REMOVED***;
#endif

#endif  // NAN_PERSISTENT_12_INL_H_
