'use strict';
var stripAnsi = require('strip-ansi');
var codePointAt = require('code-point-at');
var isFullwidthCodePoint = require('is-fullwidth-code-point');

// https://github.com/nodejs/io.js/blob/cff7300a578be1b10001f2d967aaedc88aee6402/lib/readline.js#L1345
module.exports = function (str) ***REMOVED***
	if (typeof str !== 'string' || str.length === 0) ***REMOVED***
		return 0;
	***REMOVED***

	var width = 0;

	str = stripAnsi(str);

	for (var i = 0; i < str.length; i++) ***REMOVED***
		var code = codePointAt(str, i);

		// ignore control characters
		if (code <= 0x1f || (code >= 0x7f && code <= 0x9f)) ***REMOVED***
			continue;
		***REMOVED***

		// surrogates
		if (code >= 0x10000) ***REMOVED***
			i++;
		***REMOVED***

		if (isFullwidthCodePoint(code)) ***REMOVED***
			width += 2;
		***REMOVED*** else ***REMOVED***
			width++;
		***REMOVED***
	***REMOVED***

	return width;
***REMOVED***;
