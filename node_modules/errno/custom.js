var prr = require('prr')

function init (type, message, cause) ***REMOVED***
  prr(this, ***REMOVED***
      type    : type
    , name    : type
      // can be passed just a 'cause'
    , cause   : typeof message != 'string' ? message : cause
    , message : !!message && typeof message != 'string' ? message.message : message

  ***REMOVED***, 'ewr')
***REMOVED***

// generic prototype, not intended to be actually used - helpful for `instanceof`
function CustomError (message, cause) ***REMOVED***
  Error.call(this)
  if (Error.captureStackTrace)
    Error.captureStackTrace(this, this.constructor)
  init.call(this, 'CustomError', message, cause)
***REMOVED***

CustomError.prototype = new Error()

function createError (errno, type, proto) ***REMOVED***
  var err = function (message, cause) ***REMOVED***
    init.call(this, type, message, cause)
    //TODO: the specificity here is stupid, errno should be available everywhere
    if (type == 'FilesystemError') ***REMOVED***
      this.code    = this.cause.code
      this.path    = this.cause.path
      this.errno   = this.cause.errno
      this.message =
        (errno.errno[this.cause.errno]
          ? errno.errno[this.cause.errno].description
          : this.cause.message)
        + (this.cause.path ? ' [' + this.cause.path + ']' : '')
    ***REMOVED***
    Error.call(this)
    if (Error.captureStackTrace)
      Error.captureStackTrace(this, err)
  ***REMOVED***
  err.prototype = !!proto ? new proto() : new CustomError()
  return err
***REMOVED***

module.exports = function (errno) ***REMOVED***
  var ce = function (type, proto) ***REMOVED***
    return createError(errno, type, proto)
  ***REMOVED***
  return ***REMOVED***
      CustomError     : CustomError
    , FilesystemError : ce('FilesystemError')
    , createError     : ce
  ***REMOVED***
***REMOVED***
