#!/usr/bin/env node

var request   = require('request')
  , fs        = require('fs')

  , uvheadloc = 'https://raw.github.com/joyent/libuv/master/include/uv.h'
  , defreg    = /^\s*XX\(\s*([\-\d]+),\s*([A-Z]+),\s*"([^"]*)"\s*\)\s*\\?$/


request(uvheadloc, function (err, response) ***REMOVED***
  if (err)
    throw err

  var data, out

  data = response.body
    .split('\n')
    .map(function (line) ***REMOVED*** return line.match(defreg) ***REMOVED***)
    .filter(function (match) ***REMOVED*** return match ***REMOVED***)
    .map(function (match) ***REMOVED*** return ***REMOVED***
        errno: parseInt(match[1], 10)
      , code: match[2]
      , description: match[3]
    ***REMOVED******REMOVED***)

  out = 'var all = module.exports.all = ' + JSON.stringify(data, 0, 1) + '\n\n'

  out += '\nmodule.exports.errno = ***REMOVED***\n    '
    + data.map(function (e, i) ***REMOVED***
        return '\'' + e.errno + '\': all[' + i + ']'
      ***REMOVED***).join('\n  , ')
    + '\n***REMOVED***\n\n'

  out += '\nmodule.exports.code = ***REMOVED***\n    '
    + data.map(function (e, i) ***REMOVED***
        return '\'' + e.code + '\': all[' + i + ']'
      ***REMOVED***).join('\n  , ')
    + '\n***REMOVED***\n\n'

  out += '\nmodule.exports.custom = require("./custom")(module.exports)\n'

  fs.writeFile('errno.js', out)
***REMOVED***)