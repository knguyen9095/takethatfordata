'use strict';
const path = require('path');
const pathKey = require('path-key');

module.exports = opts => ***REMOVED***
	opts = Object.assign(***REMOVED***
		cwd: process.cwd(),
		path: process.env[pathKey()]
	***REMOVED***, opts);

	let prev;
	let pth = path.resolve(opts.cwd);
	const ret = [];

	while (prev !== pth) ***REMOVED***
		ret.push(path.join(pth, 'node_modules/.bin'));
		prev = pth;
		pth = path.resolve(pth, '..');
	***REMOVED***

	// ensure the running `node` binary is used
	ret.push(path.dirname(process.execPath));

	return ret.concat(opts.path).join(path.delimiter);
***REMOVED***;

module.exports.env = opts => ***REMOVED***
	opts = Object.assign(***REMOVED***
		env: process.env
	***REMOVED***, opts);

	const env = Object.assign(***REMOVED******REMOVED***, opts.env);
	const path = pathKey(***REMOVED***env***REMOVED***);

	opts.path = env[path];
	env[path] = module.exports(opts);

	return env;
***REMOVED***;
