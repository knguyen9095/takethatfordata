"use strict";

var compact   = require("../array/#/compact")
  , isObject  = require("../object/is-object")
  , toArray   = require("../object/to-array")
  , isArray   = Array.isArray
  , stringify = JSON.stringify;

module.exports = function self(value /*, replacer, space*/) ***REMOVED***
	var replacer = arguments[1], space = arguments[2];
	try ***REMOVED***
		return stringify(value, replacer, space);
	***REMOVED*** catch (e) ***REMOVED***
		if (!isObject(value)) return null;
		if (typeof value.toJSON === "function") return null;
		if (isArray(value)) ***REMOVED***
			return (
				"[" +
				compact.call(
					value.map(function (item) ***REMOVED***
						return self(item, replacer, space);
					***REMOVED***)
				) +
				"]"
			);
		***REMOVED***
		return (
			"***REMOVED***" +
			compact
				.call(
					toArray(value, function (item, key) ***REMOVED***
						item = self(item, replacer, space);
						if (!item) return null;
						return stringify(key) + ":" + item;
					***REMOVED***)
				)
				.join(",") +
			"***REMOVED***"
		);
	***REMOVED***
***REMOVED***;
