"use strict";

var forEach       = require("./for-each")
  , isPlainObject = require("./is-plain-object")
  , ensureValue   = require("./valid-value")
  , isArray       = Array.isArray;

var copyValue = function (value, ancestors, ancestorsCopy) ***REMOVED***
	var mode;
	if (isPlainObject(value)) mode = "object";
	else if (isArray(value)) mode = "array";
	if (!mode) return value;

	var copy = ancestorsCopy[ancestors.indexOf(value)];
	if (copy) return copy;
	copy = mode === "object" ? ***REMOVED******REMOVED*** : [];

	ancestors.push(value);
	ancestorsCopy.push(copy);
	if (mode === "object") ***REMOVED***
		forEach(value, function (item, key) ***REMOVED***
			copy[key] = copyValue(item, ancestors, ancestorsCopy);
		***REMOVED***);
	***REMOVED*** else ***REMOVED***
		value.forEach(function (item, index) ***REMOVED***
			copy[index] = copyValue(item, ancestors, ancestorsCopy);
		***REMOVED***);
	***REMOVED***
	ancestors.pop();
	ancestorsCopy.pop();

	return copy;
***REMOVED***;

module.exports = function (source) ***REMOVED***
	return copyValue(ensureValue(source), [], []);
***REMOVED***;
