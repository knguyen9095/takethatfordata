"use strict";

var isValue         = require("../object/is-value")
  , toNaturalNumber = require("../number/to-pos-integer");

var generated = Object.create(null), random = Math.random, uniqTryLimit = 100;

var getChunk = function () ***REMOVED***
	return random()
		.toString(36)
		.slice(2);
***REMOVED***;

var getString = function (/* length */) ***REMOVED***
	var str = getChunk(), length = arguments[0];
	if (!isValue(length)) return str;
	while (str.length < length) str += getChunk();
	return str.slice(0, length);
***REMOVED***;

module.exports = function (/* options */) ***REMOVED***
	var options = Object(arguments[0]), length = options.length, isUnique = options.isUnique;

	if (isValue(length)) length = toNaturalNumber(length);

	var str = getString(length);
	if (isUnique) ***REMOVED***
		var count = 0;
		while (generated[str]) ***REMOVED***
			if (++count === uniqTryLimit) ***REMOVED***
				throw new Error(
					"Cannot generate random string.\n" +
						"String.random is not designed to effectively generate many short and " +
						"unique random strings"
				);
			***REMOVED***
			str = getString(length);
		***REMOVED***
		generated[str] = true;
	***REMOVED***
	return str;
***REMOVED***;
