"use strict";

var iteratorSymbol = require("es6-symbol").iterator
  , isArguments    = require("../../function/is-arguments")
  , isFunction     = require("../../function/is-function")
  , toPosInt       = require("../../number/to-pos-integer")
  , callable       = require("../../object/valid-callable")
  , validValue     = require("../../object/valid-value")
  , isValue        = require("../../object/is-value")
  , isString       = require("../../string/is-string")
  , isArray        = Array.isArray
  , call           = Function.prototype.call
  , desc           = ***REMOVED*** configurable: true, enumerable: true, writable: true, value: null ***REMOVED***
  , defineProperty = Object.defineProperty;

// eslint-disable-next-line complexity
module.exports = function (arrayLike /*, mapFn, thisArg*/) ***REMOVED***
	var mapFn = arguments[1]
	  , thisArg = arguments[2]
	  , Context
	  , i
	  , j
	  , arr
	  , length
	  , code
	  , iterator
	  , result
	  , getIterator
	  , value;

	arrayLike = Object(validValue(arrayLike));

	if (isValue(mapFn)) callable(mapFn);
	if (!this || this === Array || !isFunction(this)) ***REMOVED***
		// Result: Plain array
		if (!mapFn) ***REMOVED***
			if (isArguments(arrayLike)) ***REMOVED***
				// Source: Arguments
				length = arrayLike.length;
				if (length !== 1) return Array.apply(null, arrayLike);
				arr = new Array(1);
				arr[0] = arrayLike[0];
				return arr;
			***REMOVED***
			if (isArray(arrayLike)) ***REMOVED***
				// Source: Array
				arr = new Array(length = arrayLike.length);
				for (i = 0; i < length; ++i) arr[i] = arrayLike[i];
				return arr;
			***REMOVED***
		***REMOVED***
		arr = [];
	***REMOVED*** else ***REMOVED***
		// Result: Non plain array
		Context = this;
	***REMOVED***

	if (!isArray(arrayLike)) ***REMOVED***
		if ((getIterator = arrayLike[iteratorSymbol]) !== undefined) ***REMOVED***
			// Source: Iterator
			iterator = callable(getIterator).call(arrayLike);
			if (Context) arr = new Context();
			result = iterator.next();
			i = 0;
			while (!result.done) ***REMOVED***
				value = mapFn ? call.call(mapFn, thisArg, result.value, i) : result.value;
				if (Context) ***REMOVED***
					desc.value = value;
					defineProperty(arr, i, desc);
				***REMOVED*** else ***REMOVED***
					arr[i] = value;
				***REMOVED***
				result = iterator.next();
				++i;
			***REMOVED***
			length = i;
		***REMOVED*** else if (isString(arrayLike)) ***REMOVED***
			// Source: String
			length = arrayLike.length;
			if (Context) arr = new Context();
			for (i = 0, j = 0; i < length; ++i) ***REMOVED***
				value = arrayLike[i];
				if (i + 1 < length) ***REMOVED***
					code = value.charCodeAt(0);
					// eslint-disable-next-line max-depth
					if (code >= 0xd800 && code <= 0xdbff) value += arrayLike[++i];
				***REMOVED***
				value = mapFn ? call.call(mapFn, thisArg, value, j) : value;
				if (Context) ***REMOVED***
					desc.value = value;
					defineProperty(arr, j, desc);
				***REMOVED*** else ***REMOVED***
					arr[j] = value;
				***REMOVED***
				++j;
			***REMOVED***
			length = j;
		***REMOVED***
	***REMOVED***
	if (length === undefined) ***REMOVED***
		// Source: array or array-like
		length = toPosInt(arrayLike.length);
		if (Context) arr = new Context(length);
		for (i = 0; i < length; ++i) ***REMOVED***
			value = mapFn ? call.call(mapFn, thisArg, arrayLike[i], i) : arrayLike[i];
			if (Context) ***REMOVED***
				desc.value = value;
				defineProperty(arr, i, desc);
			***REMOVED*** else ***REMOVED***
				arr[i] = value;
			***REMOVED***
		***REMOVED***
	***REMOVED***
	if (Context) ***REMOVED***
		desc.value = null;
		arr.length = length;
	***REMOVED***
	return arr;
***REMOVED***;
