/*jshint node:true */
'use strict';
var Buffer = require('buffer').Buffer; // browserify
var SlowBuffer = require('buffer').SlowBuffer;

module.exports = bufferEq;

function bufferEq(a, b) ***REMOVED***

  // shortcutting on type is necessary for correctness
  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) ***REMOVED***
    return false;
  ***REMOVED***

  // buffer sizes should be well-known information, so despite this
  // shortcutting, it doesn't leak any information about the *contents* of the
  // buffers.
  if (a.length !== b.length) ***REMOVED***
    return false;
  ***REMOVED***

  var c = 0;
  for (var i = 0; i < a.length; i++) ***REMOVED***
    /*jshint bitwise:false */
    c |= a[i] ^ b[i]; // XOR
  ***REMOVED***
  return c === 0;
***REMOVED***

bufferEq.install = function() ***REMOVED***
  Buffer.prototype.equal = SlowBuffer.prototype.equal = function equal(that) ***REMOVED***
    return bufferEq(this, that);
  ***REMOVED***;
***REMOVED***;

var origBufEqual = Buffer.prototype.equal;
var origSlowBufEqual = SlowBuffer.prototype.equal;
bufferEq.restore = function() ***REMOVED***
  Buffer.prototype.equal = origBufEqual;
  SlowBuffer.prototype.equal = origSlowBufEqual;
***REMOVED***;
