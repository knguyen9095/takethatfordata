'use strict'

var extend = require('extend')
var request = require('retry-request')

var BASE_URL = 'http://metadata.google.internal/computeMetadata/v1'

var gcpMetadata = ***REMOVED***
  _buildMetadataAccessor: function (type) ***REMOVED***
    return function (options, callback) ***REMOVED***
      if (typeof options === 'function') ***REMOVED***
        callback = options
        options = ***REMOVED******REMOVED***
      ***REMOVED***

      if (typeof options === 'string') ***REMOVED***
        options = ***REMOVED***
          property: options
        ***REMOVED***
      ***REMOVED***

      var property = options.property ? '/' + options.property : ''

      var reqOpts = extend(true, ***REMOVED***
        uri: BASE_URL + '/' + type + property,
        headers: ***REMOVED*** 'Metadata-Flavor': 'Google' ***REMOVED***
      ***REMOVED***, options)
      delete reqOpts.property

      return request(reqOpts, function (err, res, body) ***REMOVED***
        if (err) ***REMOVED***
          callback(err)
        ***REMOVED*** else if (!res) ***REMOVED***
          callback(new Error('Invalid response from metadata service'))
        ***REMOVED*** else if (res.statusCode !== 200) ***REMOVED***
          callback(new Error('Unsuccessful response status code'), res)
        ***REMOVED*** else ***REMOVED***
          callback(null, res, body)
        ***REMOVED***
      ***REMOVED***)
    ***REMOVED***
  ***REMOVED***
***REMOVED***

gcpMetadata.instance = gcpMetadata._buildMetadataAccessor('instance')
gcpMetadata.project = gcpMetadata._buildMetadataAccessor('project')

module.exports = gcpMetadata

