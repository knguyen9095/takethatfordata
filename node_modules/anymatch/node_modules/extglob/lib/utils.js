'use strict';

var regex = require('regex-not');
var Cache = require('fragment-cache');

/**
 * Utils
 */

var utils = module.exports;
var cache = utils.cache = new Cache();

/**
 * Cast `val` to an array
 * @return ***REMOVED***Array***REMOVED***
 */

utils.arrayify = function(val) ***REMOVED***
  if (!Array.isArray(val)) ***REMOVED***
    return [val];
  ***REMOVED***
  return val;
***REMOVED***;

/**
 * Memoize a generated regex or function
 */

utils.memoize = function(type, pattern, options, fn) ***REMOVED***
  var key = utils.createKey(type + pattern, options);

  if (cache.has(type, key)) ***REMOVED***
    return cache.get(type, key);
  ***REMOVED***

  var val = fn(pattern, options);
  if (options && options.cache === false) ***REMOVED***
    return val;
  ***REMOVED***

  cache.set(type, key, val);
  return val;
***REMOVED***;

/**
 * Create the key to use for memoization. The key is generated
 * by iterating over the options and concatenating key-value pairs
 * to the pattern string.
 */

utils.createKey = function(pattern, options) ***REMOVED***
  var key = pattern;
  if (typeof options === 'undefined') ***REMOVED***
    return key;
  ***REMOVED***
  for (var prop in options) ***REMOVED***
    key += ';' + prop + '=' + String(options[prop]);
  ***REMOVED***
  return key;
***REMOVED***;

/**
 * Create the regex to use for matching text
 */

utils.createRegex = function(str) ***REMOVED***
  var opts = ***REMOVED***contains: true, strictClose: false***REMOVED***;
  return regex(str, opts);
***REMOVED***;
