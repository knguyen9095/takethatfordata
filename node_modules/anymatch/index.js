'use strict';

var micromatch = require('micromatch');
var normalize = require('normalize-path');
var path = require('path'); // required for tests.
var arrify = function(a) ***REMOVED*** return a == null ? [] : (Array.isArray(a) ? a : [a]); ***REMOVED***;

var anymatch = function(criteria, value, returnIndex, startIndex, endIndex) ***REMOVED***
  criteria = arrify(criteria);
  value = arrify(value);
  if (arguments.length === 1) ***REMOVED***
    return anymatch.bind(null, criteria.map(function(criterion) ***REMOVED***
      return typeof criterion === 'string' && criterion[0] !== '!' ?
        micromatch.matcher(criterion) : criterion;
    ***REMOVED***));
  ***REMOVED***
  startIndex = startIndex || 0;
  var string = value[0];
  var altString, altValue;
  var matched = false;
  var matchIndex = -1;
  function testCriteria(criterion, index) ***REMOVED***
    var result;
    switch (Object.prototype.toString.call(criterion)) ***REMOVED***
    case '[object String]':
      result = string === criterion || altString && altString === criterion;
      result = result || micromatch.isMatch(string, criterion);
      break;
    case '[object RegExp]':
      result = criterion.test(string) || altString && criterion.test(altString);
      break;
    case '[object Function]':
      result = criterion.apply(null, value);
      result = result || altValue && criterion.apply(null, altValue);
      break;
    default:
      result = false;
    ***REMOVED***
    if (result) ***REMOVED***
      matchIndex = index + startIndex;
    ***REMOVED***
    return result;
  ***REMOVED***
  var crit = criteria;
  var negGlobs = crit.reduce(function(arr, criterion, index) ***REMOVED***
    if (typeof criterion === 'string' && criterion[0] === '!') ***REMOVED***
      if (crit === criteria) ***REMOVED***
        // make a copy before modifying
        crit = crit.slice();
      ***REMOVED***
      crit[index] = null;
      arr.push(criterion.substr(1));
    ***REMOVED***
    return arr;
  ***REMOVED***, []);
  if (!negGlobs.length || !micromatch.any(string, negGlobs)) ***REMOVED***
    if (path.sep === '\\' && typeof string === 'string') ***REMOVED***
      altString = normalize(string);
      altString = altString === string ? null : altString;
      if (altString) altValue = [altString].concat(value.slice(1));
    ***REMOVED***
    matched = crit.slice(startIndex, endIndex).some(testCriteria);
  ***REMOVED***
  return returnIndex === true ? matchIndex : matched;
***REMOVED***;

module.exports = anymatch;
