var t = require('tap')

process.env.TEST_PSEUDOMAP = 'true'

var PM = require('../')
runTests(PM)

// if possible, verify that Map also behaves the same way
if (typeof Map === 'function')
  runTests(Map)


function runTests (Map) ***REMOVED***
  t.throws(Map)

  var m = new Map()

  t.equal(m.size, 0)

  m.set(1, '1 string')
  t.equal(m.get(1), '1 string')
  t.equal(m.size, 1)
  m.size = 1000
  t.equal(m.size, 1)
  m.size = 0
  t.equal(m.size, 1)

  m = new Map([[1, 'number 1'], ['1', 'string 1']])
  t.equal(m.get(1), 'number 1')
  t.equal(m.get('1'), 'string 1')
  t.equal(m.size, 2)

  m = new Map(m)
  t.equal(m.get(1), 'number 1')
  t.equal(m.get('1'), 'string 1')
  t.equal(m.size, 2)

  var akey = ***REMOVED******REMOVED***
  var bkey = ***REMOVED******REMOVED***
  m.set(akey, ***REMOVED*** some: 'data' ***REMOVED***)
  m.set(bkey, ***REMOVED*** some: 'other data' ***REMOVED***)
  t.same(m.get(akey), ***REMOVED*** some: 'data' ***REMOVED***)
  t.same(m.get(bkey), ***REMOVED*** some: 'other data' ***REMOVED***)
  t.equal(m.size, 4)

  var x = /x/
  var y = /x/
  m.set(x, 'x regex')
  m.set(y, 'y regex')
  t.equal(m.get(x), 'x regex')
  m.set(x, 'x again')
  t.equal(m.get(x), 'x again')
  t.equal(m.size, 6)

  m.set(NaN, 'not a number')
  t.equal(m.get(NaN), 'not a number')
  m.set(NaN, 'it is a ' + typeof NaN)
  t.equal(m.get(NaN), 'it is a number')
  m.set('NaN', 'stringie nan')
  t.equal(m.get(NaN), 'it is a number')
  t.equal(m.get('NaN'), 'stringie nan')
  t.equal(m.size, 8)

  m.delete(NaN)
  t.equal(m.get(NaN), undefined)
  t.equal(m.size, 7)

  var expect = [
    ***REMOVED*** value: 'number 1', key: 1 ***REMOVED***,
    ***REMOVED*** value: 'string 1', key: '1' ***REMOVED***,
    ***REMOVED*** value: ***REMOVED*** some: 'data' ***REMOVED***, key: ***REMOVED******REMOVED*** ***REMOVED***,
    ***REMOVED*** value: ***REMOVED*** some: 'other data' ***REMOVED***, key: ***REMOVED******REMOVED*** ***REMOVED***,
    ***REMOVED*** value: 'x again', key: /x/ ***REMOVED***,
    ***REMOVED*** value: 'y regex', key: /x/ ***REMOVED***,
    ***REMOVED*** value: 'stringie nan', key: 'NaN' ***REMOVED***
  ]
  var actual = []

  m.forEach(function (value, key) ***REMOVED***
    actual.push(***REMOVED*** value: value, key: key ***REMOVED***)
  ***REMOVED***)
  t.same(actual, expect)

  m.clear()
  t.equal(m.size, 0)
***REMOVED***
