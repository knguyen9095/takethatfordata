"use strict";
/**
 * Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var __extends = (this && this.__extends) || (function () ***REMOVED***
    var extendStatics = Object.setPrototypeOf ||
        (***REMOVED*** __proto__: [] ***REMOVED*** instanceof Array && function (d, b) ***REMOVED*** d.__proto__ = b; ***REMOVED***) ||
        function (d, b) ***REMOVED*** for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; ***REMOVED***;
    return function (d, b) ***REMOVED***
        extendStatics(d, b);
        function __() ***REMOVED*** this.constructor = d; ***REMOVED***
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    ***REMOVED***;
***REMOVED***)();
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true ***REMOVED***);
var request = require("request");
// tslint:disable-next-line
var pkg = require('../package.json');
var RequestError = /** @class */ (function (_super) ***REMOVED***
    __extends(RequestError, _super);
    function RequestError() ***REMOVED***
        return _super !== null && _super.apply(this, arguments) || this;
    ***REMOVED***
    return RequestError;
***REMOVED***(Error));
exports.RequestError = RequestError;
var DefaultTransporter = /** @class */ (function () ***REMOVED***
    function DefaultTransporter() ***REMOVED***
    ***REMOVED***
    /**
     * Configures request options before making a request.
     * @param ***REMOVED***object***REMOVED*** opts Options to configure.
     * @return ***REMOVED***object***REMOVED*** Configured options.
     */
    DefaultTransporter.prototype.configure = function (opts) ***REMOVED***
        // set transporter user agent
        opts.headers = opts.headers || ***REMOVED******REMOVED***;
        if (!opts.headers['User-Agent']) ***REMOVED***
            opts.headers['User-Agent'] = DefaultTransporter.USER_AGENT;
        ***REMOVED***
        else if (opts.headers['User-Agent'].indexOf(DefaultTransporter.USER_AGENT) ===
            -1) ***REMOVED***
            opts.headers['User-Agent'] =
                opts.headers['User-Agent'] + ' ' + DefaultTransporter.USER_AGENT;
        ***REMOVED***
        return opts;
    ***REMOVED***;
    /**
     * Makes a request with given options and invokes callback.
     * @param ***REMOVED***object***REMOVED*** opts Options.
     * @param ***REMOVED***Function=***REMOVED*** callback Optional callback.
     * @return ***REMOVED***Request***REMOVED*** Request object
     */
    DefaultTransporter.prototype.request = function (opts, callback) ***REMOVED***
        opts = this.configure(opts);
        return request(opts.uri || opts.url, opts, this.wrapCallback_(callback));
    ***REMOVED***;
    /**
     * Wraps the response callback.
     * @param ***REMOVED***Function=***REMOVED*** callback Optional callback.
     * @return ***REMOVED***Function***REMOVED*** Wrapped callback function.
     * @private
     */
    DefaultTransporter.prototype.wrapCallback_ = function (callback) ***REMOVED***
        return function (err, res, body) ***REMOVED***
            if (err || !body) ***REMOVED***
                return callback && callback(err, body, res);
            ***REMOVED***
            // Only and only application/json responses should
            // be decoded back to JSON, but there are cases API back-ends
            // responds without proper content-type.
            try ***REMOVED***
                body = JSON.parse(body);
            ***REMOVED***
            catch (err) ***REMOVED***
                /* no op */
            ***REMOVED***
            if (body && body.error && res.statusCode !== 200) ***REMOVED***
                if (typeof body.error === 'string') ***REMOVED***
                    err = new RequestError(body.error);
                    err.code = res.statusCode;
                ***REMOVED***
                else if (Array.isArray(body.error.errors)) ***REMOVED***
                    err = new RequestError(body.error.errors.map(function (err2) ***REMOVED*** return err2.message; ***REMOVED***).join('\n'));
                    err.code = body.error.code;
                    err.errors = body.error.errors;
                ***REMOVED***
                else ***REMOVED***
                    err = new RequestError(body.error.message);
                    err.code = body.error.code || res.statusCode;
                ***REMOVED***
                body = null;
            ***REMOVED***
            else if (res.statusCode >= 400) ***REMOVED***
                // Consider all 4xx and 5xx responses errors.
                err = new RequestError(body);
                err.code = res.statusCode;
                body = null;
            ***REMOVED***
            if (callback) ***REMOVED***
                callback(err, body, res);
            ***REMOVED***
        ***REMOVED***;
    ***REMOVED***;
    /**
     * Default user agent.
     */
    DefaultTransporter.USER_AGENT = 'google-api-nodejs-client/' + pkg.version;
    return DefaultTransporter;
***REMOVED***());
exports.DefaultTransporter = DefaultTransporter;
//# sourceMappingURL=transporters.js.map