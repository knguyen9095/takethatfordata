/*!
 * static-extend <https://github.com/jonschlinkert/static-extend>
 *
 * Copyright (c) 2016, Jon Schlinkert.
 * Licensed under the MIT License.
 */

'use strict';

var copy = require('object-copy');
var define = require('define-property');
var util = require('util');

/**
 * Returns a function for extending the static properties,
 * prototype properties, and descriptors from the `Parent`
 * constructor onto `Child` constructors.
 *
 * ```js
 * var extend = require('static-extend');
 * Parent.extend = extend(Parent);
 *
 * // optionally pass a custom merge function as the second arg
 * Parent.extend = extend(Parent, function(Child) ***REMOVED***
 *   Child.prototype.mixin = function(key, val) ***REMOVED***
 *     Child.prototype[key] = val;
 *   ***REMOVED***;
 * ***REMOVED***);
 *
 * // extend "child" constructors
 * Parent.extend(Child);
 *
 * // optionally define prototype methods as the second arg
 * Parent.extend(Child, ***REMOVED***
 *   foo: function() ***REMOVED******REMOVED***,
 *   bar: function() ***REMOVED******REMOVED***
 * ***REMOVED***);
 * ```
 * @param ***REMOVED***Function***REMOVED*** `Parent` Parent ctor
 * @param ***REMOVED***Function***REMOVED*** `extendFn` Optional extend function for handling any necessary custom merging. Useful when updating methods that require a specific prototype.
 *   @param ***REMOVED***Function***REMOVED*** `Child` Child ctor
 *   @param ***REMOVED***Object***REMOVED*** `proto` Optionally pass additional prototype properties to inherit.
 *   @return ***REMOVED***Object***REMOVED***
 * @api public
 */

function extend(Parent, extendFn) ***REMOVED***
  if (typeof Parent !== 'function') ***REMOVED***
    throw new TypeError('expected Parent to be a function.');
  ***REMOVED***

  return function(Ctor, proto) ***REMOVED***
    if (typeof Ctor !== 'function') ***REMOVED***
      throw new TypeError('expected Ctor to be a function.');
    ***REMOVED***

    util.inherits(Ctor, Parent);
    copy(Ctor, Parent);

    // proto can be null or a plain object
    if (typeof proto === 'object') ***REMOVED***
      var obj = Object.create(proto);

      for (var k in obj) ***REMOVED***
        Ctor.prototype[k] = obj[k];
      ***REMOVED***
    ***REMOVED***

    // keep a reference to the parent prototype
    define(Ctor.prototype, '_parent_', ***REMOVED***
      configurable: true,
      set: function() ***REMOVED******REMOVED***,
      get: function() ***REMOVED***
        return Parent.prototype;
      ***REMOVED***
    ***REMOVED***);

    if (typeof extendFn === 'function') ***REMOVED***
      extendFn(Ctor, Parent);
    ***REMOVED***

    Ctor.extend = extend(Ctor, extendFn);
  ***REMOVED***;
***REMOVED***;

/**
 * Expose `extend`
 */

module.exports = extend;
