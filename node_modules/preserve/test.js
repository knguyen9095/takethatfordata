/*!
 * preserve <https://github.com/jonschlinkert/preserve>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License
 */

'use strict';

var should = require('should');
var tokens = require('./');

var re = /<%=\s*[^>]+%>/g;
var pretty = function(str) ***REMOVED***
  return require('js-beautify').html(str, ***REMOVED***
    indent_char: ' ',
    indent_size: 2,
  ***REMOVED***);
***REMOVED***;

describe('preserve tokens', function () ***REMOVED***
  var testRe = /__ID.***REMOVED***5***REMOVED***__\n__ID.***REMOVED***5***REMOVED***__\n__ID.***REMOVED***5***REMOVED***__/;
  var re = /<%=\s*[^>]+%>/g;

  it('should (e.g. shouldn\'t, but will) mangle tokens in the given string', function () ***REMOVED***
    var html = pretty('<ul><li><%= name %></li></ul>');
    html.should.equal('<ul>\n  <li>\n    <%=n ame %>\n  </li>\n</ul>');
  ***REMOVED***);

  it('should preserve tokens in the given string', function () ***REMOVED***
    var html = tokens.after(pretty(tokens.before('<ul><li><%= name %></li></ul>', re)));
    html.should.equal('<ul>\n  <li><%= name %></li>\n</ul>');
  ***REMOVED***);

  describe('.before()', function () ***REMOVED***
    it('should replace matches with placeholder tokens:', function () ***REMOVED***
      tokens.before('<%= a %>\n<%= b %>\n<%= c %>', re).should.match(testRe);
    ***REMOVED***);
  ***REMOVED***);

  describe('tokens.after()', function () ***REMOVED***
    it('should replace placeholder tokens with original values:', function () ***REMOVED***
      var before = tokens.before('<%= a %>\n<%= b %>\n<%= c %>', re);
      before.should.match(testRe);
      tokens.after(before).should.equal('<%= a %>\n<%= b %>\n<%= c %>');
    ***REMOVED***);
  ***REMOVED***);
***REMOVED***);
