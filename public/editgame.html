
 <!-- add.html -->
<!DOCTYPE html>
<html>

<head> 
  <title> Take that for Data! </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
   <link rel="stylesheet" type="text/css" href="/css/main.css">
   <link rel="stylesheet" href="/css/shotchart.css">
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <title>Input Stats</title>
    <script src='https://code.jquery.com/jquery-3.1.0.min.js'></script>
    <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
     <script src="/js/logout.js" ></script>
    
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#top">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    <a class="navbar-brand" href="/"> Take that for Data </a>
  </div>
    <div class="collapse navbar-collapse" id="top">
       <ul class="nav navbar-nav navbar-right">
        <li><a href="#about">About</a></li>
        <li><a href="/dashboard">Dashboard</a></li>
        <li><a href="#">Account</a></li>
        <li><a href="#" onclick="return signout();">Logout</a> </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Sidebar -->


 <div id="sidebar-wrapper">
    <div class="side-top">
       <a href="/dashboard"> Team Name</a>
    </div>
            <ul class="sidebar-nav">
                <li class="sidebar-dark"><a href="/newseason">+ New Season  </a> </li>
                <li class="sidebar-dark"> <a href="/newgame">+ New Game </a> </li>
                <li class="sidebar-dark"> <a href="/editgame"> Edit Game</a> </li>
                <li class="sidebar-dark"> <a href="/viewstats"> View stats</a></li>
                  
                
                  <ul>
  </div> <!-- #end sidebar-wrapper -->
<div class="jumbotron text-center">
  <h1>Edit Game</h1>
  <p> Your Games </p>
    <ul class="gameliststyle">
      <li id="gamelist"></li>
    </ul>
	<p id="activegame"> </p>

	<form action="../input">
    <input type="submit" value="Go to Game" />
</form>
</div>
 <!-- Javascript -->
<script>
  // Initialize Firebase
var db = firebase.database();
displayactgame()
firebase.auth().onAuthStateChanged(function(user) {
//create game list 
  if (user) {
	var ref = db.ref("/users/" + user.uid + "/teams");
	ref.on("child_added", function (snapshot) {
	  var ss = snapshot.val();
	  var key = snapshot.key;
	  var reff = db.ref("/users/" + user.uid + "/teams/" + key + "/season_" + 
		ss.active_season + "/games/");
	  reff.on("child_added", function(game_snap) {
		var gss = game_snap.val();
		var ele = document.createElement("li");
		var a = document.createElement("a");
		var v = document.createTextNode(gss.date + " at " + gss.location + " vs " + gss.opponent);
		a.appendChild(v);
		a.href = "#";
		ele.appendChild(a);
		ele.name = game_snap.key;
		ele.onclick = function() {
			var actgameref = db.ref("/users/" + user.uid + "/teams/" + key);
			actgameref.update({"active_game": ele.name});
			displayactgame();
		};
		var gamelist = document.getElementById("gamelist");
		gamelist.appendChild(ele);
		});		
	});
  } else { 
  }
 });
 
function displayactgame() {
  firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    var ref = db.ref("/users/" + user.uid + "/teams");
	ref.on("child_added", function (snapshot) {
	  var ss = snapshot.val();
	  var key = snapshot.key;
	  var season = ss.active_season;
	  var game = ss.active_game;
	  var actgameref = db.ref("/users/" + user.uid + "/teams/" + key + "/season_" +
	    ss.active_season + "/games/" + game);
	  actgameref.once("value", function(snap) {
	    var gamedata = snap.val();
	    var field = document.getElementById("activegame");
		field.innerHTML = "Active Game: " + gamedata.date + " at " + gamedata.location + " vs " + gamedata.opponent
	  });
	});
  }
  });
}
 
function signout(){
    firebase.auth().signOut().then(function() {
  // Sign-out successful.
   window.location = '../'; 
}).catch(function(error) {
  // An error happened.
  console.log("Error: " + error.code);
});
return true;

  }
</script>

</body>
</html>
