
 <!-- account.html -->
<!DOCTYPE html>
<html>

<head> 
  <title> Take that for Data! </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
   <link rel="stylesheet" type="text/css" href="/css/main.css">
   <link rel="stylesheet" href="/css/shotchart.css">
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>

  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <title>Input Stats</title>
    <script src='https://code.jquery.com/jquery-3.1.0.min.js'></script>
    <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
    <script src="/js/d3-shotchart.js" ></script>
   
    
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#top">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    <a class="navbar-brand" href="/"> Take that for Data </a>
  </div>
    <div class="collapse navbar-collapse" id="top">
      <ul class="nav navbar-nav navbar-right">
         <li><a href="../"> Search </a></li>
        <li><a href="../about">About</a></li>
        <li><a href="#"> Account </a></li>
         <li><a href="#" onclick="return signout();"> Logout </a></li>
      </ul>
    </div>

  </div>
</nav>

 <!-- Sidebar -->


 <div id="sidebar-wrapper">
    <div class="side-top">
        <a href="../">Search</a>
    </div>
            <ul class="sidebar-nav">
                <li class="sidebar-dark"><a href="/newseason">+ New Season  </a> </li>
                <li class="sidebar-dark"> <a href="/newgame">+ New Game </a> </li>
                <li class="sidebar-dark"> <a href="/editgame"> Edit Game</a> </li>
                <li class="sidebar-dark"> <a href="/viewstats"> View Stats</a></li>
                  
                
                  <ul>
  </div> <!-- #end sidebar-wrapper -->


<div class="jumbotron text-center">
  <div id="inside" class="textleft">
    <p></p>
<p></p>
  <div class="topwhite">
    <h2> Your information </h2>
    <form id="userinfo">
  <div class="form-group">
    <label for="exampleFormControlInput1">Email address</label>
    <input type="email" class="form-control" id="email" placeholder="name@example.com">

    <br><label for="exampleFormControlInput1">Team Name</label>
    <input type="input" class="form-control" id="teamname" placeholder="Team name">
    <br>
  <br><label for="exampleFormControlInput1">New Password</label>
    <input type="input" class="form-control" id="newpassword" placeholder="new password">

    <br><label for="exampleFormControlInput1">Confirm New Password</label>
    <input type="input" class="form-control" id="newpassword1" placeholder="new password">
  </div>
  </form>

  <input type="button" name="submit" value="Save" onClick="saveinfo()" class="btn btn-default">
</div> </div><!-- end of topwhite class-->

<div id="insideplayer" class="box textleft">
  <h2> Players  </h2>
  <form id="playerform">
  <div class="form-row">
    <div class="col-md-3 mb-3">
      <label for="validationCustom01">First name</label>
      <input type="text" class="form-control" id="firstname" placeholder="First name">
    
    </div>
    <div class="col-md-3 mb-3">
      <label for="validationCustom02">Last name</label>
      <input type="text" class="form-control" id="lastname" placeholder="Last name">
   
    </div>
    <div class="col-md-3 mb-3">
      <label for="validationCustomUsername">Number</label>
     <input type="text" class="form-control" id="number" placeholder="Number">
  </div>

  <p><br>
      <input type="button" name="submit" value="Add" onClick="addnewplayer()" class="btn btn-default">
      </form>

      <table id="playerstable" class="table table-striped"> 
            
              <tr id="first">
                <th>First Name</th>
              <th>Last Name</th> 
              <th>Number</th>
              <th></th>
              </tr>
          
               <tbody id="players"></tbody>
           </table>
           
                <ul>
                <li id="playerkey" hidden> </li>
              </ul>


</div>
</div>




 <!-- Javascript -->
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDmi6qgpfnoCZ8a2FM2APfX74dXfiJ9PFY",
    authDomain: "takethatfordata-8f719.firebaseapp.com",
    databaseURL: "https://takethatfordata-8f719.firebaseio.com",
    projectId: "takethatfordata-8f719",
    storageBucket: "takethatfordata-8f719.appspot.com",
    messagingSenderId: "211430446462"
  };
  firebase.initializeApp(config);
  var db = firebase.database();
  updatelist();
  var user = firebase.auth().currentUser;
  var name, email;

if (user != null) {
  user.providerData.forEach(function (profile) {
    console.log("Sign-in provider: " + profile.providerId);
    console.log("  Provider-specific UID: " + profile.uid);
    console.log("  Name: " + profile.displayName);
    console.log("  Email: " + profile.email);
    console.log("  Photo URL: " + profile.photoURL);
  });
}

function saveinfo(){
  var email = document.getElementById("email").value;
  var teamname = document.getElementById("teamname").value;
  var password = document.getElementById("newpassword").value;
  var password1 = document.getElementById("newpassword1").value;
  var form = document.getElementById("userinfo").value;
  var user = firebase.auth().currentUser;
  emailtoval = acctEmail.value;
  email = JSON.stringify(emailtoval);

}

function addnewplayer() {
  var x = document.getElementById("firstname").value;
  var y = document.getElementById("lastname").value;
  var z = document.getElementById("number").value;
  var form = document.getElementById("playerform").value;
  var user = firebase.auth().currentUser;

  if ( x.length < 1) {
  alert('Error: Please enter name');
  return;
}
  if (y.length < 1) {
    alert('Error: Please enter last name');
    return;
  }

  if (z.length < 1) {
    alert('Error: Please enter Player Number');
    return;
  }
  if (user) {
    
    var ref = db.ref("/users/" + user.uid + "/teams/");
    ref.on("child_added", function(snapshot) {
      var ss = snapshot.val();
      var reff = db.ref("/users/" + user.uid + "/teams/" + snapshot.key + "/season_" + ss.active_season + "/players");
      var obj = { "firstname":x, "lastname":y, "number":z};
      reff.push(obj);   
      clearFields()

    });
  } else {
    // No user is signed in.
    console.log("Error not logged in");
    }
  }
function del(playerkey) {
  var user = firebase.auth().currentUser;
  if (user) {
    var ref = db.ref("/users/" + user.uid + "/teams/");
    ref.on("child_added", function(snapshot) {
      var ss = snapshot.val();
    var reff = db.ref("/users/" + user.uid + "/teams/" + snapshot.key + "/season_" + ss.active_season + "/players/" + playerkey );
    reff.remove();
    });
  } else {
    // No user is signed in.
    console.log("Error not logged in");
  }
  updatelist();
}

function clearFields(){
  document.getElementById("pfname").value = "";
  document.getElementById("plname").value = "";
  document.getElementById("pnumber").value = "";
}

function updatelist() {
var playerlist = document.getElementById("players");
while (playerlist.childNodes.length > 0) {
  playerlist.removeChild(playerlist.lastChild);
}
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    //This code lists the players in the current team's active season
    var ref = db.ref("/users/" + user.uid + "/teams");
  ref.on("child_added", function (snapshot) {
    var ss = snapshot.val();
    var reff = db.ref("/users/" + user.uid + "/teams/" + snapshot.key + "/season_" +
      ss.active_season + "/players/");
    reff.on("child_added", function (snapshot_player) {
      snap = snapshot_player.val();
    var row = document.createElement("tr");
    var firstname = document.createElement("td");
    var lastname = document.createElement("td");
    var number = document.createElement("td");
    firstname.innerHTML = snap.firstname;
    lastname.innerHTML = snap.lastname;
    number.innerHTML = snap.number;
    row.appendChild(firstname);
    row.appendChild(lastname);
    row.appendChild(number);
    var col = document.createElement("td");
    var delbutton = document.createElement("input");
    delbutton.type = "button";
    delbutton.value = "Delete";
    delbutton.id = snapshot_player.key;
    delbutton.onclick = function() {
      del(this.id);
    };
    col.appendChild(delbutton);
    row.appendChild(col);
    var playerlist = document.getElementById("players");
    playerlist.appendChild(row);
    
    
    });
  });
  } else {
      console.log("Error not logged in");
  }
});
} 


// -- signout--
  function signout(){
    firebase.auth().signOut().then(function() {
  // Sign-out successful.
   window.location = '../'; 
}).catch(function(error) {
  // An error happened.
  console.log("Error: " + error.code);
});
return true;

  }

 // if the user is not sign it, they cannot access this page
  firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in.
  } else {
    // No user is signed in.
    window.location = '../'; 
  }
});
</script>

</body>
</html>
